<Project Sdk="Microsoft.NET.Sdk.Web">
    <PropertyGroup>
        <NoWarn>CA1303;EPC12</NoWarn>
        <EnforceExtendedAnalyzerRules>true</EnforceExtendedAnalyzerRules>
    </PropertyGroup>

    <ItemGroup>
        <ProjectReference Include="../../DataProvider/DataProvider/DataProvider.csproj" />
        <ProjectReference Include="../../Other/Selecta/Selecta.csproj" />
        <ProjectReference Include="../../Sync/Sync/Sync.csproj" />
        <ProjectReference Include="../../Sync/Sync.SQLite/Sync.SQLite.csproj" />
    </ItemGroup>

    <ItemGroup>
        <PackageReference Include="Microsoft.Data.Sqlite" Version="9.0.0" />
    </ItemGroup>

    <ItemGroup>
        <AdditionalFiles Include="Queries/*.sql" />
        <AdditionalFiles Include="Queries/*.grouping.json" />
        <AdditionalFiles Include="DataProvider.json" />
        <AdditionalFiles Include="schema.sql" />
    </ItemGroup>

    <!-- Pre-compile: generate C# from SQL using external CLI -->
    <Target Name="GenerateDataProvider" BeforeTargets="CoreCompile">
        <RemoveDir Directories="$(IntermediateOutputPath)Generated" />
        <MakeDir Directories="$(IntermediateOutputPath)Generated" />
        <Exec Command='dotnet run --project $(MSBuildThisFileDirectory)../../DataProvider/DataProvider.SQLite.Cli/DataProvider.SQLite.Cli.csproj -- --project-dir &quot;$(MSBuildProjectDirectory)&quot; --config &quot;$(MSBuildProjectDirectory)/DataProvider.json&quot; --out &quot;$(IntermediateOutputPath)Generated&quot; --schema &quot;$(MSBuildProjectDirectory)/schema.sql&quot;' WorkingDirectory='$(MSBuildProjectDirectory)' StandardOutputImportance='High' StandardErrorImportance='High' IgnoreExitCode='true' />
        <ItemGroup>
            <Compile Include="$(IntermediateOutputPath)Generated/**/*.g.cs" Visible="false" />
        </ItemGroup>
    </Target>
</Project>
