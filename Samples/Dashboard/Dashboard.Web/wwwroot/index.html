<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Healthcare Dashboard - Clinical and Scheduling Management">
  <title>Healthcare Dashboard</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%232ca3fa' width='100' height='100' rx='20'/%3E%3Cpath fill='white' d='M50 20v60M20 50h60' stroke='white' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/layout.css">

  <!-- Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <!-- React (local bundle for offline/test support) -->
  <script src="js/vendor/react.development.js"></script>
  <script src="js/vendor/react-dom.development.js"></script>

  <style>
    /* Loading screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-blue-subtle) 0%, var(--teal-soft) 50%, var(--white) 100%);
      z-index: 9999;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--teal-bold) 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      animation: pulse 2s ease-in-out infinite;
    }

    .loading-logo svg {
      width: 48px;
      height: 48px;
    }

    .loading-text {
      font-size: 18px;
      font-weight: 500;
      color: var(--gray-700);
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--gray-200);
      border-top-color: var(--primary-blue);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-logo">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
      </svg>
    </div>
    <div class="loading-text">Healthcare Dashboard</div>
    <div class="loading-spinner"></div>
  </div>

  <!-- React Root -->
  <div id="root"></div>

  <!-- H5 Generated JavaScript - DISABLED: has broken React hooks (calls useState from static method) -->
  <!-- <script src="js/Dashboard.js"></script> -->

  <!-- Pure JS React Dashboard -->
  <script>
    // Hide loading screen after a delay
    setTimeout(function() {
      document.getElementById('loading-screen').classList.add('hidden');
    }, 1500);

    // Load Google Charts
    google.charts.load('current', {
      'packages': ['corechart', 'line', 'bar', 'gauge']
    });

    // Flag to track when charts are ready
    let googleChartsLoaded = false;
    google.charts.setOnLoadCallback(() => {
      googleChartsLoaded = true;
      console.log('[Dashboard] Google Charts loaded!');
    });

    // Load the React dashboard
    console.log('[Dashboard] Loading React dashboard...');

      // API Configuration
      const CLINICAL_API = window.dashboardConfig?.CLINICAL_API_URL || 'http://localhost:5080';
      const SCHEDULING_API = window.dashboardConfig?.SCHEDULING_API_URL || 'http://localhost:5001';
      const GATEKEEPER_API = window.dashboardConfig?.GATEKEEPER_API_URL || 'http://localhost:5002';

      // Auth token storage
      const AUTH_TOKEN_KEY = 'gatekeeper_token';
      const AUTH_USER_KEY = 'gatekeeper_user';

      const getAuthToken = () => localStorage.getItem(AUTH_TOKEN_KEY);
      const setAuthToken = (token) => localStorage.setItem(AUTH_TOKEN_KEY, token);
      const getAuthUser = () => {
        const user = localStorage.getItem(AUTH_USER_KEY);
        return user ? JSON.parse(user) : null;
      };
      const setAuthUser = (user) => localStorage.setItem(AUTH_USER_KEY, JSON.stringify(user));
      const clearAuth = () => {
        localStorage.removeItem(AUTH_TOKEN_KEY);
        localStorage.removeItem(AUTH_USER_KEY);
      };

      // API helper (with optional auth)
      const fetchApi = async (url, requireAuth = false) => {
        try {
          const headers = { 'Accept': 'application/json' };
          const token = getAuthToken();
          if (token && requireAuth) {
            headers['Authorization'] = `Bearer ${token}`;
          }
          const response = await fetch(url, { headers });
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return await response.json();
        } catch (error) {
          console.error(`[API Error] ${url}:`, error);
          throw error;
        }
      };

      // Custom hooks
      const useFetch = (url, dependencies = []) => {
        const [data, setData] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          let mounted = true;
          setLoading(true);
          fetchApi(url)
            .then(result => { if (mounted) { setData(result); setError(null); } })
            .catch(err => { if (mounted) setError(err.message); })
            .finally(() => { if (mounted) setLoading(false); });
          return () => { mounted = false; };
        }, dependencies);

        return { data, loading, error };
      };

      // POST API helper (with optional auth)
      const postApi = async (url, data, requireAuth = false) => {
        const headers = { 'Content-Type': 'application/json', 'Accept': 'application/json' };
        const token = getAuthToken();
        if (token && requireAuth) {
          headers['Authorization'] = `Bearer ${token}`;
        }
        const response = await fetch(url, {
          method: 'POST',
          headers,
          body: JSON.stringify(data)
        });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      };

      // Icons as SVG components
      const Icons = {
        Home: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z' }),
          React.createElement('polyline', { points: '9,22 9,12 15,12 15,22' })
        ),
        Users: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2' }),
          React.createElement('circle', { cx: 9, cy: 7, r: 4 }),
          React.createElement('path', { d: 'M23 21v-2a4 4 0 00-3-3.87' }),
          React.createElement('path', { d: 'M16 3.13a4 4 0 010 7.75' })
        ),
        UserDoctor: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2' }),
          React.createElement('circle', { cx: 12, cy: 7, r: 4 }),
          React.createElement('line', { x1: 12, y1: 11, x2: 12, y2: 17 }),
          React.createElement('line', { x1: 9, y1: 14, x2: 15, y2: 14 })
        ),
        Calendar: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('rect', { x: 3, y: 4, width: 18, height: 18, rx: 2, ry: 2 }),
          React.createElement('line', { x1: 16, y1: 2, x2: 16, y2: 6 }),
          React.createElement('line', { x1: 8, y1: 2, x2: 8, y2: 6 }),
          React.createElement('line', { x1: 3, y1: 10, x2: 21, y2: 10 })
        ),
        Clipboard: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2' }),
          React.createElement('rect', { x: 8, y: 2, width: 8, height: 4, rx: 1, ry: 1 })
        ),
        Search: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 11, cy: 11, r: 8 }),
          React.createElement('line', { x1: 21, y1: 21, x2: 16.65, y2: 16.65 })
        ),
        Bell: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9' }),
          React.createElement('path', { d: 'M13.73 21a2 2 0 01-3.46 0' })
        ),
        ChevronLeft: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '15,18 9,12 15,6' })
        ),
        ChevronRight: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '9,6 15,12 9,18' })
        ),
        Activity: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '22,12 18,12 15,21 9,3 6,12 2,12' })
        ),
        AlertCircle: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
          React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
          React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
        ),
        TrendUp: () => React.createElement('svg', { className: 'icon icon-sm', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '23,6 13.5,15.5 8.5,10.5 1,18' }),
          React.createElement('polyline', { points: '17,6 23,6 23,12' })
        ),
        TrendDown: () => React.createElement('svg', { className: 'icon icon-sm', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '23,18 13.5,8.5 8.5,13.5 1,6' }),
          React.createElement('polyline', { points: '17,18 23,18 23,12' })
        ),
        Close: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
          React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
        ),
        Edit: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7' }),
          React.createElement('path', { d: 'M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z' })
        ),
        Sync: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M23 4v6h-6' }),
          React.createElement('path', { d: 'M1 20v-6h6' }),
          React.createElement('path', { d: 'M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15' })
        ),
        Filter: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polygon', { points: '22,3 2,3 10,12.46 10,19 14,21 14,12.46 22,3' })
        ),
        RefreshCw: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '23,4 23,10 17,10' }),
          React.createElement('polyline', { points: '1,20 1,14 7,14' }),
          React.createElement('path', { d: 'M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15' })
        ),
        CheckCircle: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M22 11.08V12a10 10 0 11-5.93-9.14' }),
          React.createElement('polyline', { points: '22,4 12,14.01 9,11.01' })
        ),
        XCircle: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
          React.createElement('line', { x1: 15, y1: 9, x2: 9, y2: 15 }),
          React.createElement('line', { x1: 9, y1: 9, x2: 15, y2: 15 })
        ),
        Clock: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
          React.createElement('polyline', { points: '12,6 12,12 16,14' })
        ),
        Database: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('ellipse', { cx: 12, cy: 5, rx: 9, ry: 3 }),
          React.createElement('path', { d: 'M21 12c0 1.66-4 3-9 3s-9-1.34-9-3' }),
          React.createElement('path', { d: 'M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5' })
        ),
        LogOut: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4' }),
          React.createElement('polyline', { points: '16,17 21,12 16,7' }),
          React.createElement('line', { x1: 21, y1: 12, x2: 9, y2: 12 })
        )
      };

      // Modal Component
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null;
        return React.createElement('div', { className: 'modal-backdrop open', onClick: onClose },
          React.createElement('div', { className: 'modal', onClick: e => e.stopPropagation() },
            React.createElement('div', { className: 'modal-header' },
              React.createElement('h3', { className: 'modal-title' }, title),
              React.createElement('button', { className: 'modal-close', onClick: onClose },
                React.createElement(Icons.Close)
              )
            ),
            children
          )
        );
      };

      // Add Patient Modal Component
      const AddPatientModal = ({ isOpen, onClose, onSuccess }) => {
        const [formData, setFormData] = React.useState({ GivenName: '', FamilyName: '', Gender: 'other', Active: true });
        const [submitting, setSubmitting] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSubmitting(true);
          setError(null);
          try {
            await postApi(`${CLINICAL_API}/fhir/Patient/`, formData);
            setFormData({ GivenName: '', FamilyName: '', Gender: 'other', Active: true });
            onSuccess();
            onClose();
          } catch (err) {
            setError(err.message);
          } finally {
            setSubmitting(false);
          }
        };

        return React.createElement(Modal, { isOpen, onClose, title: 'Add New Patient' },
          React.createElement('form', { onSubmit: handleSubmit },
            React.createElement('div', { className: 'modal-body' },
              error && React.createElement('div', { className: 'alert alert-error mb-4' }, error),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Given Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter given name',
                  value: formData.GivenName,
                  onChange: e => setFormData({ ...formData, GivenName: e.target.value }),
                  required: true,
                  'data-testid': 'patient-given-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Family Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter family name',
                  value: formData.FamilyName,
                  onChange: e => setFormData({ ...formData, FamilyName: e.target.value }),
                  required: true,
                  'data-testid': 'patient-family-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Gender'),
                React.createElement('select', {
                  className: 'input',
                  value: formData.Gender,
                  onChange: e => setFormData({ ...formData, Gender: e.target.value }),
                  'data-testid': 'patient-gender'
                },
                  React.createElement('option', { value: 'male' }, 'Male'),
                  React.createElement('option', { value: 'female' }, 'Female'),
                  React.createElement('option', { value: 'other' }, 'Other')
                )
              )
            ),
            React.createElement('div', { className: 'modal-footer' },
              React.createElement('button', { type: 'button', className: 'btn btn-secondary', onClick: onClose }, 'Cancel'),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: submitting, 'data-testid': 'submit-patient' },
                submitting ? 'Saving...' : 'Add Patient'
              )
            )
          )
        );
      };

      // Add Appointment Modal Component
      const AddAppointmentModal = ({ isOpen, onClose, onSuccess }) => {
        const [formData, setFormData] = React.useState({
          ServiceCategory: 'General',
          ServiceType: 'Checkup',
          Priority: 'routine',
          PatientReference: 'Patient/1',
          PractitionerReference: 'Practitioner/1',
          Start: new Date().toISOString().slice(0, 16),
          End: new Date(Date.now() + 3600000).toISOString().slice(0, 16)
        });
        const [submitting, setSubmitting] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSubmitting(true);
          setError(null);
          try {
            await postApi(`${SCHEDULING_API}/Appointment`, {
              ...formData,
              Start: new Date(formData.Start).toISOString(),
              End: new Date(formData.End).toISOString()
            });
            onSuccess();
            onClose();
          } catch (err) {
            setError(err.message);
          } finally {
            setSubmitting(false);
          }
        };

        return React.createElement(Modal, { isOpen, onClose, title: 'New Appointment' },
          React.createElement('form', { onSubmit: handleSubmit },
            React.createElement('div', { className: 'modal-body' },
              error && React.createElement('div', { className: 'alert alert-error mb-4' }, error),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Service Type'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Checkup, Consultation',
                  value: formData.ServiceType,
                  onChange: e => setFormData({ ...formData, ServiceType: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-service-type'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Patient Reference'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Patient/1',
                  value: formData.PatientReference,
                  onChange: e => setFormData({ ...formData, PatientReference: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-patient-ref'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Practitioner Reference'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Practitioner/1',
                  value: formData.PractitionerReference,
                  onChange: e => setFormData({ ...formData, PractitionerReference: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-practitioner-ref'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Start Time'),
                React.createElement('input', {
                  type: 'datetime-local',
                  className: 'input',
                  value: formData.Start,
                  onChange: e => setFormData({ ...formData, Start: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-start'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'End Time'),
                React.createElement('input', {
                  type: 'datetime-local',
                  className: 'input',
                  value: formData.End,
                  onChange: e => setFormData({ ...formData, End: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-end'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Priority'),
                React.createElement('select', {
                  className: 'input',
                  value: formData.Priority,
                  onChange: e => setFormData({ ...formData, Priority: e.target.value }),
                  'data-testid': 'appointment-priority'
                },
                  React.createElement('option', { value: 'routine' }, 'Routine'),
                  React.createElement('option', { value: 'urgent' }, 'Urgent'),
                  React.createElement('option', { value: 'asap' }, 'ASAP'),
                  React.createElement('option', { value: 'stat' }, 'STAT')
                )
              )
            ),
            React.createElement('div', { className: 'modal-footer' },
              React.createElement('button', { type: 'button', className: 'btn btn-secondary', onClick: onClose }, 'Cancel'),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: submitting, 'data-testid': 'submit-appointment' },
                submitting ? 'Saving...' : 'Create Appointment'
              )
            )
          )
        );
      };

      // Add Practitioner Modal Component
      const AddPractitionerModal = ({ isOpen, onClose, onSuccess }) => {
        const [formData, setFormData] = React.useState({
          Identifier: '',
          NameGiven: '',
          NameFamily: '',
          Qualification: 'MD',
          Specialty: '',
          TelecomEmail: '',
          TelecomPhone: ''
        });
        const [submitting, setSubmitting] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSubmitting(true);
          setError(null);
          try {
            await postApi(`${SCHEDULING_API}/Practitioner`, formData);
            setFormData({
              Identifier: '',
              NameGiven: '',
              NameFamily: '',
              Qualification: 'MD',
              Specialty: '',
              TelecomEmail: '',
              TelecomPhone: ''
            });
            onSuccess();
            onClose();
          } catch (err) {
            setError(err.message);
          } finally {
            setSubmitting(false);
          }
        };

        return React.createElement(Modal, { isOpen, onClose, title: 'Add New Practitioner' },
          React.createElement('form', { onSubmit: handleSubmit },
            React.createElement('div', { className: 'modal-body' },
              error && React.createElement('div', { className: 'alert alert-error mb-4' }, error),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Identifier (e.g. DR001)'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter identifier',
                  value: formData.Identifier,
                  onChange: e => setFormData({ ...formData, Identifier: e.target.value }),
                  required: true,
                  'data-testid': 'practitioner-identifier'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Given Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter given name',
                  value: formData.NameGiven,
                  onChange: e => setFormData({ ...formData, NameGiven: e.target.value }),
                  required: true,
                  'data-testid': 'practitioner-given-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Family Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter family name',
                  value: formData.NameFamily,
                  onChange: e => setFormData({ ...formData, NameFamily: e.target.value }),
                  required: true,
                  'data-testid': 'practitioner-family-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Qualification'),
                React.createElement('select', {
                  className: 'input',
                  value: formData.Qualification,
                  onChange: e => setFormData({ ...formData, Qualification: e.target.value }),
                  'data-testid': 'practitioner-qualification'
                },
                  React.createElement('option', { value: 'MD' }, 'MD - Doctor of Medicine'),
                  React.createElement('option', { value: 'DO' }, 'DO - Doctor of Osteopathy'),
                  React.createElement('option', { value: 'NP' }, 'NP - Nurse Practitioner'),
                  React.createElement('option', { value: 'PA' }, 'PA - Physician Assistant'),
                  React.createElement('option', { value: 'RN' }, 'RN - Registered Nurse')
                )
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Specialty'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Cardiology, General Practice',
                  value: formData.Specialty,
                  onChange: e => setFormData({ ...formData, Specialty: e.target.value }),
                  'data-testid': 'practitioner-specialty'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Email'),
                React.createElement('input', {
                  type: 'email',
                  className: 'input',
                  placeholder: 'doctor@hospital.com',
                  value: formData.TelecomEmail,
                  onChange: e => setFormData({ ...formData, TelecomEmail: e.target.value }),
                  'data-testid': 'practitioner-email'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Phone'),
                React.createElement('input', {
                  type: 'tel',
                  className: 'input',
                  placeholder: '+1-555-0100',
                  value: formData.TelecomPhone,
                  onChange: e => setFormData({ ...formData, TelecomPhone: e.target.value }),
                  'data-testid': 'practitioner-phone'
                })
              )
            ),
            React.createElement('div', { className: 'modal-footer' },
              React.createElement('button', { type: 'button', className: 'btn btn-secondary', onClick: onClose }, 'Cancel'),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: submitting, 'data-testid': 'submit-practitioner' },
                submitting ? 'Saving...' : 'Add Practitioner'
              )
            )
          )
        );
      };

      // Metric Card Component
      const MetricCard = ({ label, value, icon, iconColor, trend, trendValue, loading }) => (
        React.createElement('div', { className: 'metric-card' },
          React.createElement('div', { className: `metric-icon ${iconColor}` }, icon),
          React.createElement('div', { className: 'metric-value' }, loading ? '-' : value),
          React.createElement('div', { className: 'metric-label' }, label),
          trendValue && React.createElement('div', { className: `metric-trend ${trend}` },
            trend === 'up' ? React.createElement(Icons.TrendUp) : React.createElement(Icons.TrendDown),
            ' ', trendValue
          )
        )
      );

      // Data Table Component
      const DataTable = ({ columns, data, loading, onRowClick }) => {
        if (loading) {
          return React.createElement('div', { className: 'table-container' },
            React.createElement('div', { className: 'skeleton-rows' },
              [...Array(5)].map((_, i) => React.createElement('div', { key: i, className: 'skeleton', style: { height: '48px', marginBottom: '8px' } }))
            )
          );
        }
        if (!data || data.length === 0) {
          return React.createElement('div', { className: 'empty-state' },
            React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.Clipboard)),
            React.createElement('h4', { className: 'empty-state-title' }, 'No Data'),
            React.createElement('p', { className: 'empty-state-description' }, 'No records found')
          );
        }
        return React.createElement('div', { className: 'table-container' },
          React.createElement('table', { className: 'table' },
            React.createElement('thead', null,
              React.createElement('tr', null,
                columns.map(col => React.createElement('th', { key: col.key }, col.header))
              )
            ),
            React.createElement('tbody', null,
              data.map((row, i) =>
                React.createElement('tr', {
                  key: row.Id || row.id || i,
                  className: onRowClick ? 'cursor-pointer' : '',
                  onClick: onRowClick ? () => onRowClick(row) : undefined
                },
                  columns.map(col =>
                    React.createElement('td', { key: col.key }, col.render ? col.render(row) : row[col.key])
                  )
                )
              )
            )
          )
        );
      };

      // Mini Sparkline Chart Component
      const Sparkline = ({ data, color = 'var(--primary-blue)', height = 40 }) => {
        const max = Math.max(...data);
        const min = Math.min(...data);
        const range = max - min || 1;
        const width = 100;
        const points = data.map((v, i) => `${(i / (data.length - 1)) * width},${height - ((v - min) / range) * height}`).join(' ');
        return React.createElement('svg', { viewBox: `0 0 ${width} ${height}`, style: { width: '100%', height: `${height}px` }, preserveAspectRatio: 'none' },
          React.createElement('polyline', { fill: 'none', stroke: color, strokeWidth: 2, points }),
          React.createElement('polyline', { fill: `${color}20`, stroke: 'none', points: `0,${height} ${points} ${width},${height}` })
        );
      };

      // Donut Chart Component
      const DonutChart = ({ value, max = 100, size = 80, strokeWidth = 8, color = 'var(--primary-blue)' }) => {
        const radius = (size - strokeWidth) / 2;
        const circumference = 2 * Math.PI * radius;
        const percent = Math.min(value / max, 1);
        const offset = circumference * (1 - percent);
        return React.createElement('svg', { width: size, height: size, style: { transform: 'rotate(-90deg)' } },
          React.createElement('circle', { cx: size/2, cy: size/2, r: radius, fill: 'none', stroke: 'var(--gray-200)', strokeWidth }),
          React.createElement('circle', { cx: size/2, cy: size/2, r: radius, fill: 'none', stroke: color, strokeWidth, strokeDasharray: circumference, strokeDashoffset: offset, strokeLinecap: 'round' })
        );
      };

      // Bar Chart Component
      const BarChart = ({ data, height = 120 }) => {
        const max = Math.max(...data.map(d => d.value));
        return React.createElement('div', { className: 'bar-chart', style: { display: 'flex', alignItems: 'flex-end', gap: '8px', height: `${height}px` } },
          data.map((d, i) => React.createElement('div', { key: i, className: 'bar-chart-item', style: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' } },
            React.createElement('div', {
              className: 'bar',
              style: {
                width: '100%',
                height: `${(d.value / max) * 100}%`,
                background: `linear-gradient(to top, ${d.color || 'var(--primary-blue)'}, ${d.colorLight || 'var(--primary-blue-subtle)'})`,
                borderRadius: '4px 4px 0 0',
                minHeight: '4px'
              }
            }),
            React.createElement('span', { style: { fontSize: '10px', color: 'var(--gray-500)' } }, d.label)
          ))
        );
      };

      // Google Area Chart Component
      const GoogleAreaChart = ({ data, title, height = 200, colors = ['#3b82f6', '#14b8a6'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' }, baselineColor: '#e5e7eb' }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, baselineColor: '#e5e7eb', minValue: 0 }, legend: { position: 'top', alignment: 'end', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors, areaOpacity: 0.15, lineWidth: 3, pointSize: 0, curveType: 'function', chartArea: { left: 50, top: 40, width: '85%', height: '70%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.AreaChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Pie/Donut Chart Component
      const GooglePieChart = ({ data, title, height = 200, colors, pieHole = 0.5 }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, pieHole: pieHole, pieSliceTextStyle: { color: '#ffffff', fontSize: 11, fontName: 'Inter' }, legend: { position: 'right', alignment: 'center', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors || ['#3b82f6', '#14b8a6', '#22c55e', '#f59e0b', '#f97316', '#8b5cf6'], chartArea: { left: 20, top: 30, width: '90%', height: '80%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.PieChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors, pieHole]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Column Chart Component
      const GoogleColumnChart = ({ data, title, height = 200, colors = ['#14b8a6'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' } }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, minValue: 0 }, legend: { position: 'none' }, colors: colors, bar: { groupWidth: '60%' }, chartArea: { left: 50, top: 30, width: '85%', height: '70%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.ColumnChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Line Chart Component
      const GoogleLineChart = ({ data, title, height = 200, colors = ['#3b82f6', '#14b8a6', '#f97316'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' } }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, minValue: 0 }, legend: { position: 'top', alignment: 'end', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors, lineWidth: 3, pointSize: 5, curveType: 'function', chartArea: { left: 50, top: 40, width: '85%', height: '65%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.LineChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Calendar Date Picker Component
      const CalendarPicker = ({ selectedDate, onSelect }) => {
        const today = new Date();
        const [currentMonth] = React.useState(today.getMonth());
        const [currentYear] = React.useState(today.getFullYear());
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const days = [];
        for (let i = 0; i < firstDay; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(i);

        return React.createElement('div', { className: 'calendar-picker' },
          React.createElement('div', { className: 'calendar-header' },
            React.createElement('span', { className: 'calendar-month' },
              new Date(currentYear, currentMonth).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
            )
          ),
          React.createElement('div', { className: 'calendar-weekdays' },
            ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(d =>
              React.createElement('div', { key: d, className: 'calendar-weekday' }, d)
            )
          ),
          React.createElement('div', { className: 'calendar-days' },
            days.map((day, i) =>
              React.createElement('div', {
                key: i,
                className: `calendar-day ${day === today.getDate() ? 'today' : ''} ${day === selectedDate ? 'selected' : ''} ${!day ? 'empty' : ''}`,
                onClick: day ? () => onSelect(day) : undefined
              }, day)
            )
          )
        );
      };

      // Appointment Request Card
      const AppointmentRequestCard = ({ patient, type, time, onAccept, onReject }) => (
        React.createElement('div', { className: 'appointment-request' },
          React.createElement('div', { className: 'appointment-request-info' },
            React.createElement('div', { className: 'avatar avatar-md', style: { background: 'var(--teal-soft)', color: 'var(--teal-dark)' } },
              patient.split(' ').map(n => n[0]).join('')
            ),
            React.createElement('div', { className: 'appointment-request-details' },
              React.createElement('div', { className: 'appointment-request-name' }, patient),
              React.createElement('div', { className: 'appointment-request-type' }, type),
              React.createElement('div', { className: 'appointment-request-time' },
                React.createElement(Icons.Calendar),
                React.createElement('span', null, time)
              )
            )
          ),
          React.createElement('div', { className: 'appointment-request-actions' },
            React.createElement('button', { className: 'btn-icon-circle reject', onClick: onReject, title: 'Reject' }, '×'),
            React.createElement('button', { className: 'btn-icon-circle accept', onClick: onAccept, title: 'Accept' }, '✓')
          )
        )
      );

      // Rich Metric Card with breakdown
      const RichMetricCard = ({ title, value, change, changeType, icon, breakdown, chart, loading }) => (
        React.createElement('div', { className: 'metric-card metric-card-rich' },
          React.createElement('div', { className: 'metric-card-header' },
            React.createElement('div', { className: 'metric-card-icon' }, icon),
            React.createElement('span', { className: 'metric-card-title' }, title),
            React.createElement('a', { href: '#', className: 'metric-card-link' }, 'View more')
          ),
          React.createElement('div', { className: 'metric-card-body' },
            React.createElement('div', { className: 'metric-card-value-row' },
              React.createElement('span', { className: 'metric-card-value' }, loading ? '-' : value),
              change && React.createElement('span', { className: `metric-card-change ${changeType}` }, change)
            ),
            breakdown && React.createElement('div', { className: 'metric-card-breakdown' },
              breakdown.map((item, i) =>
                React.createElement('span', { key: i, className: 'metric-breakdown-item' },
                  React.createElement('span', { className: 'metric-breakdown-dot', style: { background: item.color } }),
                  item.label
                )
              )
            ),
            chart
          )
        )
      );

      // Dashboard Page - Professional Healthcare Design
      const DashboardPage = ({ onNavigate }) => {
        const patients = useFetch(`${CLINICAL_API}/fhir/Patient`);
        const practitioners = useFetch(`${SCHEDULING_API}/Practitioner`);
        const appointments = useFetch(`${SCHEDULING_API}/Appointment`);
        const [selectedDate, setSelectedDate] = React.useState(new Date().getDate());

        const hasError = patients.error || practitioners.error || appointments.error;
        const isLoading = patients.loading || practitioners.loading || appointments.loading;

        // Sample data for charts
        const weeklyData = [35, 45, 38, 52, 48, 60, 55];
        const monthlyTrend = [120, 145, 132, 168, 155, 180, 175, 190, 185, 210, 198, 220];
        const treatmentBreakdown = [
          { label: 'Surgery', color: 'var(--primary-blue)' },
          { label: 'Consultation', color: 'var(--teal-bold)' },
          { label: 'Diagnosis', color: 'var(--success)' },
          { label: 'Biopsy', color: 'var(--warning)' }
        ];
        const revenueData = [
          { label: 'Jan', value: 120, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Feb', value: 180, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Mar', value: 150, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Apr', value: 220, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'May', value: 190, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Jun', value: 250, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' }
        ];

        // Mock upcoming appointments
        const upcomingAppointments = [
          { patient: 'Jane Cooper', treatment: 'Consultation', status: 'Confirmed', date: 'Mar. 22', time: '10:00AM' },
          { patient: 'Guy Hawkins', treatment: 'Diagnosis', status: 'Confirmed', date: 'Mar. 22', time: '11:00AM' },
          { patient: 'Cameron Williamson', treatment: 'Surgery', status: 'Confirmed', date: 'Mar. 22', time: '12:30PM' },
          { patient: 'Jerome Bell', treatment: 'Consultation', status: 'Confirmed', date: 'Mar. 22', time: '3:00PM' }
        ];

        // Mock appointment requests
        const appointmentRequests = [
          { patient: 'Jane Cooper', type: 'Individual consultation', time: '02 Apr, 10:00 am' },
          { patient: 'Albert Flores', type: 'Individual consultation', time: '04 Apr, 09:00 am' },
          { patient: 'Kristin Watson', type: 'Individual consultation', time: '04 Apr, 02:00 pm' }
        ];

        return React.createElement('div', { className: 'page dashboard-page' },
          // Welcome Header
          React.createElement('div', { className: 'dashboard-welcome' },
            React.createElement('h2', { className: 'welcome-title' }, 'Welcome back, Dr. Robert!'),
            React.createElement('div', { className: 'welcome-actions' },
              React.createElement('div', { className: 'date-filter' },
                React.createElement('span', null, 'Monthly'),
                React.createElement(Icons.Calendar)
              ),
              React.createElement('button', { className: 'btn btn-outline' }, 'Export data')
            )
          ),

          // Connection Warning
          hasError && React.createElement('div', { className: 'alert alert-warning mb-6' },
            React.createElement(Icons.AlertCircle),
            React.createElement('div', null,
              React.createElement('strong', null, 'Connection Warning'),
              React.createElement('p', null, 'Could not connect to API. Make sure Clinical API (port 5080) and Scheduling API (port 5001) are running.')
            )
          ),

          // Top Metrics Row
          React.createElement('div', { className: 'dashboard-metrics-row' },
            React.createElement(RichMetricCard, {
              title: 'Top Treatment',
              value: '580',
              change: '+24',
              changeType: 'up',
              icon: React.createElement(Icons.Activity),
              breakdown: treatmentBreakdown,
              loading: isLoading,
              chart: React.createElement('div', { className: 'donut-chart-container' },
                React.createElement('div', { className: 'donut-legend' },
                  [180, 240, 100, 60].map((v, i) =>
                    React.createElement('div', { key: i, className: 'donut-legend-item' },
                      React.createElement(DonutChart, { value: v, max: 580, size: i === 0 ? 70 : i === 1 ? 60 : 40, strokeWidth: 6, color: treatmentBreakdown[i].color }),
                      React.createElement('span', null, v)
                    )
                  )
                )
              )
            }),
            React.createElement(RichMetricCard, {
              title: 'Satisfaction Rate',
              value: '85%',
              change: '-2%',
              changeType: 'down',
              icon: React.createElement('span', { style: { fontSize: '20px' } }, '😊'),
              loading: isLoading,
              chart: React.createElement(Sparkline, { data: weeklyData, color: 'var(--primary-blue)', height: 50 })
            }),
            React.createElement(RichMetricCard, {
              title: 'Total Patients',
              value: patients.data?.length || 620,
              change: '+28',
              changeType: 'up',
              icon: React.createElement(Icons.Users),
              breakdown: [
                { label: 'Inpatient', color: 'var(--primary-blue)' },
                { label: 'Discharged', color: 'var(--gray-400)' },
                { label: 'Outpatient', color: 'var(--teal-bold)' }
              ],
              loading: isLoading,
              chart: React.createElement('div', { className: 'patient-breakdown-bars' },
                [420, 120, 80].map((v, i) =>
                  React.createElement('div', { key: i, className: 'breakdown-bar-item' },
                    React.createElement('span', { className: 'breakdown-bar-value' }, v),
                    React.createElement('div', { className: 'breakdown-bar', style: { width: `${(v/420)*100}%`, background: ['var(--primary-blue)', 'var(--gray-300)', 'var(--teal-bold)'][i] } })
                  )
                )
              )
            }),
            React.createElement(RichMetricCard, {
              title: 'Total Appointments',
              value: appointments.data?.length || 260,
              change: '+16',
              changeType: 'up',
              icon: React.createElement(Icons.Calendar),
              loading: isLoading,
              chart: React.createElement(Sparkline, { data: monthlyTrend, color: 'var(--teal-bold)', height: 50 })
            })
          ),

          // Main Content Grid
          React.createElement('div', { className: 'dashboard-main-grid' },
            // Left Column - Appointments Table
            React.createElement('div', { className: 'dashboard-appointments-section' },
              React.createElement('div', { className: 'card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-header-left' },
                    React.createElement(Icons.Calendar),
                    React.createElement('h3', { className: 'card-title' }, 'Upcoming Appointments')
                  ),
                  React.createElement('div', { className: 'appointment-legend' },
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot available' }), 'Available'),
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot selected' }), 'Selected'),
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot unavailable' }), 'Unavailable')
                  ),
                  React.createElement('a', { href: '#', className: 'view-more-link' }, 'View more')
                ),
                React.createElement('div', { className: 'card-body' },
                  // Calendar strip
                  React.createElement('div', { className: 'calendar-strip' },
                    React.createElement('button', { className: 'calendar-nav' }, React.createElement(Icons.ChevronLeft)),
                    [...Array(9)].map((_, i) => {
                      const day = 14 + i;
                      const isToday = day === 22;
                      const isSelected = day === selectedDate;
                      return React.createElement('button', {
                        key: i,
                        className: `calendar-day-btn ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''} ${[18, 19].includes(day) ? 'has-events' : ''}`,
                        onClick: () => setSelectedDate(day)
                      }, day);
                    }),
                    React.createElement('button', { className: 'calendar-nav' }, React.createElement(Icons.ChevronRight))
                  ),
                  // Appointments table
                  React.createElement('table', { className: 'appointments-table' },
                    React.createElement('thead', null,
                      React.createElement('tr', null,
                        React.createElement('th', null, 'Patient'),
                        React.createElement('th', null, 'Treatment'),
                        React.createElement('th', null, 'Status'),
                        React.createElement('th', null, 'Date'),
                        React.createElement('th', null, 'Time'),
                        React.createElement('th', null, 'Action')
                      )
                    ),
                    React.createElement('tbody', null,
                      (appointments.data || upcomingAppointments).slice(0, 5).map((apt, i) =>
                        React.createElement('tr', { key: i },
                          React.createElement('td', null,
                            React.createElement('div', { className: 'patient-cell' },
                              React.createElement('div', { className: 'avatar avatar-sm' },
                                (apt.patient || apt.PatientReference || 'JD').substring(0, 2)
                              ),
                              apt.patient || apt.PatientReference || 'Patient'
                            )
                          ),
                          React.createElement('td', null, apt.treatment || apt.ServiceType || 'Consultation'),
                          React.createElement('td', null,
                            React.createElement('span', { className: `status-badge ${(apt.status || apt.Status || 'confirmed').toLowerCase()}` },
                              '• ', apt.status || apt.Status || 'Confirmed'
                            )
                          ),
                          React.createElement('td', null, apt.date || (apt.Start ? new Date(apt.Start).toLocaleDateString() : 'Today')),
                          React.createElement('td', null, apt.time || (apt.Start ? new Date(apt.Start).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '10:00 AM')),
                          React.createElement('td', null,
                            React.createElement('div', { className: 'action-buttons' },
                              React.createElement('button', { className: 'btn-icon-sm call' }, '📞'),
                              React.createElement('button', { className: 'btn-icon-sm more' }, '⋮')
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            ),

            // Right Column - Appointment Requests
            React.createElement('div', { className: 'dashboard-requests-section' },
              React.createElement('div', { className: 'card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-header-left' },
                    React.createElement(Icons.Calendar),
                    React.createElement('h3', { className: 'card-title' }, 'Appointment Requests')
                  ),
                  React.createElement('a', { href: '#', className: 'view-more-link' }, 'View more')
                ),
                React.createElement('div', { className: 'card-body requests-list' },
                  appointmentRequests.map((req, i) =>
                    React.createElement(AppointmentRequestCard, {
                      key: i,
                      patient: req.patient,
                      type: req.type,
                      time: req.time,
                      onAccept: () => console.log('Accept', req.patient),
                      onReject: () => console.log('Reject', req.patient)
                    })
                  )
                )
              ),

              // Quick Actions Card
              React.createElement('div', { className: 'card quick-actions-card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('h3', { className: 'card-title' }, 'Quick Actions')
                ),
                React.createElement('div', { className: 'card-body' },
                  React.createElement('div', { className: 'quick-actions-grid' },
                    React.createElement('button', { className: 'quick-action-btn primary', onClick: () => onNavigate('patients', { openAddModal: true }), 'data-testid': 'quick-new-patient' },
                      React.createElement(Icons.Users),
                      React.createElement('span', null, '+ New Patient')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('appointments', { openAddModal: true }), 'data-testid': 'quick-new-appointment' },
                      React.createElement(Icons.Calendar),
                      React.createElement('span', null, '+ New Appointment')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('patients'), 'data-testid': 'quick-patient-search' },
                      React.createElement(Icons.Search),
                      React.createElement('span', null, 'Patient Search')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('appointments'), 'data-testid': 'quick-view-schedule' },
                      React.createElement(Icons.Clipboard),
                      React.createElement('span', null, 'View Schedule')
                    )
                  )
                )
              )
            )
          ),

          // Google Charts Analytics Section
          React.createElement('div', { className: 'dashboard-charts-section' },
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Patient Activity Trends'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View details')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleAreaChart, {
                  data: [
                    ['Month', 'Outpatient', 'Inpatient'],
                    ['Jan', 120, 45], ['Feb', 145, 52], ['Mar', 132, 48],
                    ['Apr', 168, 61], ['May', 155, 58], ['Jun', 180, 65],
                    ['Jul', 175, 62], ['Aug', 190, 68], ['Sep', 185, 66],
                    ['Oct', 210, 72], ['Nov', 198, 70], ['Dec', 220, 78]
                  ],
                  height: 280,
                  colors: ['#3b82f6', '#14b8a6']
                })
              )
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Treatment Distribution'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View all')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GooglePieChart, {
                  data: [
                    ['Treatment', 'Count'],
                    ['Surgery', 180], ['Consultation', 240], ['Diagnosis', 100],
                    ['Biopsy', 60], ['Therapy', 85], ['Emergency', 45]
                  ],
                  height: 280,
                  colors: ['#3b82f6', '#14b8a6', '#22c55e', '#f59e0b', '#8b5cf6', '#f97316'],
                  pieHole: 0.5
                })
              )
            )
          ),

          // Additional Charts Row
          React.createElement('div', { className: 'dashboard-charts-section' },
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Monthly Revenue'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View report')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleColumnChart, {
                  data: [
                    ['Month', 'Revenue ($K)'],
                    ['Jan', 120], ['Feb', 180], ['Mar', 150],
                    ['Apr', 220], ['May', 190], ['Jun', 250]
                  ],
                  height: 250,
                  colors: ['#14b8a6']
                })
              )
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Appointment Completion Rate'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View analytics')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleLineChart, {
                  data: [
                    ['Week', 'Completed', 'Cancelled', 'Rescheduled'],
                    ['W1', 85, 8, 7], ['W2', 88, 6, 6], ['W3', 82, 10, 8],
                    ['W4', 90, 5, 5], ['W5', 87, 7, 6], ['W6', 92, 4, 4]
                  ],
                  height: 250,
                  colors: ['#22c55e', '#ef4444', '#f59e0b']
                })
              )
            )
          )
        );
      };

      // Patients Page
      const PatientsPage = ({ openAddModal: initialOpenModal, onEditPatient }) => {
        const [searchQuery, setSearchQuery] = React.useState('');
        const [showAddModal, setShowAddModal] = React.useState(false);
        const [refreshKey, setRefreshKey] = React.useState(0);
        const { data, loading, error } = useFetch(`${CLINICAL_API}/fhir/Patient`, [refreshKey]);

        // Open modal when navigated with openAddModal option
        React.useEffect(() => {
          if (initialOpenModal) setShowAddModal(true);
        }, [initialOpenModal]);

        const filteredData = React.useMemo(() => {
          if (!data || !searchQuery) return data || [];
          const q = searchQuery.toLowerCase();
          return data.filter(p =>
            (p.GivenName && p.GivenName.toLowerCase().includes(q)) ||
            (p.FamilyName && p.FamilyName.toLowerCase().includes(q)) ||
            (p.Id && p.Id.toString().toLowerCase().includes(q))
          );
        }, [data, searchQuery]);

        const columns = [
          { key: 'Id', header: 'ID', render: p => p.Id || '-' },
          { key: 'name', header: 'Name', render: p => `${p.GivenName || ''} ${p.FamilyName || ''}`.trim() || '-' },
          { key: 'BirthDate', header: 'Birth Date', render: p => p.BirthDate || '-' },
          { key: 'Gender', header: 'Gender', render: p => p.Gender ? p.Gender.charAt(0).toUpperCase() + p.Gender.slice(1) : '-' },
          { key: 'status', header: 'Status', render: () => React.createElement('span', { className: 'badge badge-success' }, 'Active') },
          { key: 'actions', header: 'Actions', render: p => React.createElement('button', {
            className: 'btn btn-ghost btn-sm',
            onClick: (e) => { e.stopPropagation(); onEditPatient && onEditPatient(p.Id); },
            'data-testid': `edit-patient-${p.Id}`
          }, React.createElement(Icons.Edit)) }
        ];

        return React.createElement('div', { className: 'page' },
          React.createElement(AddPatientModal, {
            isOpen: showAddModal,
            onClose: () => setShowAddModal(false),
            onSuccess: () => setRefreshKey(k => k + 1)
          }),
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Patients'),
            React.createElement('p', { className: 'page-description' }, 'Manage patient records')
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('div', { className: 'header-search' },
                React.createElement(Icons.Search),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Search patients...',
                  value: searchQuery,
                  onChange: e => setSearchQuery(e.target.value)
                })
              ),
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: () => setShowAddModal(true),
                'data-testid': 'add-patient-btn'
              }, '+ Add Patient')
            ),
            React.createElement('div', { className: 'card-body' },
              error ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
                React.createElement('h4', { className: 'empty-state-title' }, 'Could not load patients'),
                React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Clinical API is running on port 5080')
              ) : React.createElement(DataTable, { columns, data: filteredData, loading })
            )
          )
        );
      };

      // Practitioners Page
      const PractitionersPage = ({ openAddModal: initialOpenModal, onEditPractitioner }) => {
        const [showAddModal, setShowAddModal] = React.useState(false);
        const [refreshKey, setRefreshKey] = React.useState(0);
        const { data, loading, error } = useFetch(`${SCHEDULING_API}/Practitioner`, [refreshKey]);

        // Open modal when navigated with openAddModal option
        React.useEffect(() => {
          if (initialOpenModal) setShowAddModal(true);
        }, [initialOpenModal]);

        return React.createElement('div', { className: 'page' },
          React.createElement(AddPractitionerModal, {
            isOpen: showAddModal,
            onClose: () => setShowAddModal(false),
            onSuccess: () => setRefreshKey(k => k + 1)
          }),
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Practitioners'),
            React.createElement('p', { className: 'page-description' }, 'Manage healthcare providers')
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: () => setShowAddModal(true),
                'data-testid': 'add-practitioner-btn'
              }, '+ Add Practitioner')
            ),
            React.createElement('div', { className: 'card-body' },
              error ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
                React.createElement('h4', { className: 'empty-state-title' }, 'Could not load practitioners'),
                React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Scheduling API is running on port 5001')
              ) : loading ? React.createElement('div', { className: 'dashboard-grid practitioners' },
                [...Array(6)].map((_, i) => React.createElement('div', { key: i, className: 'card' },
                  React.createElement('div', { className: 'skeleton', style: { height: '200px' } })
                ))
              ) : (data || []).length === 0 ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.UserDoctor)),
                React.createElement('h4', { className: 'empty-state-title' }, 'No practitioners yet'),
                React.createElement('p', { className: 'empty-state-description' }, 'Add your first practitioner to get started')
              ) : React.createElement('div', { className: 'dashboard-grid practitioners' },
                (data || []).map(p =>
                  React.createElement('div', { key: p.Id || p.Identifier, className: 'card practitioner-card' },
                    React.createElement('button', {
                      className: 'practitioner-edit-btn',
                      onClick: () => onEditPractitioner && onEditPractitioner(p.Id),
                      'data-testid': `edit-practitioner-${p.Id}`,
                      title: 'Edit Practitioner'
                    }, React.createElement(Icons.Edit)),
                    React.createElement('div', { className: 'practitioner-avatar' },
                      React.createElement('div', { className: 'avatar avatar-lg' },
                        (p.NameGiven?.[0] || '') + (p.NameFamily?.[0] || '')
                      )
                    ),
                    React.createElement('h4', { className: 'practitioner-name' },
                      `${p.NameGiven || ''} ${p.NameFamily || ''}`.trim() || 'Unknown'
                    ),
                    React.createElement('p', { className: 'practitioner-specialty' }, p.Specialty || 'General'),
                    React.createElement('div', { className: 'practitioner-meta' },
                      React.createElement('span', { className: 'badge badge-info' }, p.Qualification || 'MD')
                    )
                  )
                )
              )
            )
          )
        );
      };

      // Appointments Page
      const AppointmentsPage = ({ openAddModal: initialOpenModal, onEditAppointment }) => {
        const [filter, setFilter] = React.useState('all');
        const [showAddModal, setShowAddModal] = React.useState(false);
        const [refreshKey, setRefreshKey] = React.useState(0);
        const { data, loading, error } = useFetch(`${SCHEDULING_API}/Appointment`, [refreshKey]);

        // Open modal when navigated with openAddModal option
        React.useEffect(() => {
          if (initialOpenModal) setShowAddModal(true);
        }, [initialOpenModal]);

        const filteredData = React.useMemo(() => {
          if (!data) return [];
          if (filter === 'all') return data;
          return data.filter(a => a.Status?.toLowerCase() === filter);
        }, [data, filter]);

        const columns = [
          { key: 'Id', header: 'ID', render: a => a.Id || '-' },
          { key: 'ServiceType', header: 'Type', render: a => a.ServiceType || a.ServiceCategory || '-' },
          { key: 'patient', header: 'Patient', render: a => a.PatientReference || '-' },
          { key: 'practitioner', header: 'Practitioner', render: a => a.PractitionerReference || '-' },
          { key: 'date', header: 'Date/Time', render: a => a.Start || a.StartTime || '-' },
          { key: 'status', header: 'Status', render: a => React.createElement('span', {
            className: `badge ${a.Status === 'booked' ? 'badge-primary' : a.Status === 'fulfilled' ? 'badge-success' : a.Status === 'cancelled' ? 'badge-danger' : 'badge-secondary'}`
          }, a.Status || 'pending') },
          { key: 'actions', header: 'Actions', render: a => React.createElement('button', {
            className: 'btn btn-secondary btn-sm',
            onClick: (e) => { e.stopPropagation(); onEditAppointment && onEditAppointment(a.Id); },
            'data-testid': `edit-appointment-${a.Id}`
          }, React.createElement(Icons.Edit)) }
        ];

        return React.createElement('div', { className: 'page' },
          React.createElement(AddAppointmentModal, {
            isOpen: showAddModal,
            onClose: () => setShowAddModal(false),
            onSuccess: () => setRefreshKey(k => k + 1)
          }),
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Appointments'),
            React.createElement('p', { className: 'page-description' }, 'Manage scheduling and appointments')
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('div', { className: 'btn-group' },
                ['all', 'booked', 'fulfilled', 'cancelled'].map(f =>
                  React.createElement('button', {
                    key: f,
                    className: `btn btn-sm ${filter === f ? 'btn-primary' : 'btn-ghost'}`,
                    onClick: () => setFilter(f)
                  }, f.charAt(0).toUpperCase() + f.slice(1))
                )
              ),
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: () => setShowAddModal(true),
                'data-testid': 'add-appointment-btn'
              }, '+ New Appointment')
            ),
            React.createElement('div', { className: 'card-body' },
              error ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
                React.createElement('h4', { className: 'empty-state-title' }, 'Could not load appointments'),
                React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Scheduling API is running on port 5001')
              ) : React.createElement(DataTable, { columns, data: filteredData, loading })
            )
          )
        );
      };

      // Placeholder Page
      const PlaceholderPage = ({ title, description }) => (
        React.createElement('div', { className: 'page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, title),
            React.createElement('p', { className: 'page-description' }, description)
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'empty-state' },
              React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.Clipboard)),
              React.createElement('h4', { className: 'empty-state-title' }, 'Coming Soon'),
              React.createElement('p', { className: 'empty-state-description' }, 'This page is under development.')
            )
          )
        )
      );

      // Calendar Page - Schedule view with monthly calendar
      const CalendarPage = ({ onEditAppointment }) => {
        const appointments = useFetch(`${SCHEDULING_API}/Appointment`);
        const [currentDate, setCurrentDate] = React.useState(new Date());
        const [selectedDay, setSelectedDay] = React.useState(null);

        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December'];
        const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();

        const navigateMonth = (delta) => {
          const newDate = new Date(currentDate);
          newDate.setMonth(newDate.getMonth() + delta);
          setCurrentDate(newDate);
          setSelectedDay(null);
        };

        const goToToday = () => {
          const today = new Date();
          setCurrentDate(today);
          setSelectedDay(today.getDate());
        };

        const getAppointmentsForDay = (day) => {
          if (!appointments.data) return [];
          const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
          return appointments.data.filter(apt => apt.StartTime && apt.StartTime.startsWith(dateStr));
        };

        const formatTime = (dateStr) => {
          if (!dateStr || dateStr.length < 16) return 'N/A';
          return dateStr.substring(11, 16);
        };

        const today = new Date();
        const isToday = (day) => day === today.getDate() && currentDate.getMonth() === today.getMonth() && currentDate.getFullYear() === today.getFullYear();
        const daysInMonth = getDaysInMonth(currentDate.getFullYear(), currentDate.getMonth());
        const firstDay = getFirstDayOfMonth(currentDate.getFullYear(), currentDate.getMonth());

        const dayElements = [];
        for (let i = 0; i < 42; i++) {
          const dayNum = i - firstDay + 1;
          if (dayNum < 1 || dayNum > daysInMonth) {
            dayElements.push(React.createElement('div', { key: i, className: 'calendar-cell empty' }));
          } else {
            const dayAppointments = getAppointmentsForDay(dayNum);
            const cellClasses = ['calendar-cell'];
            if (isToday(dayNum)) cellClasses.push('today');
            if (selectedDay === dayNum) cellClasses.push('selected');
            if (dayAppointments.length > 0) cellClasses.push('has-appointments');
            dayElements.push(React.createElement('div', {
              key: i,
              className: cellClasses.join(' '),
              onClick: () => setSelectedDay(dayNum)
            },
              React.createElement('div', { className: 'calendar-day-number' }, dayNum),
              dayAppointments.length > 0 ? React.createElement('div', { className: 'calendar-appointments-preview' },
                dayAppointments.slice(0, 3).map((apt, idx) =>
                  React.createElement('span', { key: idx, className: `calendar-dot ${apt.Status === 'booked' ? 'blue' : apt.Status === 'fulfilled' ? 'green' : 'gray'}` })
                )
              ) : null,
              dayAppointments.length > 3 ? React.createElement('span', { className: 'calendar-more-indicator' }, `+${dayAppointments.length - 3}`) : null
            ));
          }
        }

        const selectedAppointments = selectedDay ? getAppointmentsForDay(selectedDay) : [];

        return React.createElement('div', { className: 'page' },
          React.createElement('div', { className: 'page-header flex justify-between items-center mb-6' },
            React.createElement('div', null,
              React.createElement('h2', { className: 'page-title' }, 'Schedule'),
              React.createElement('p', { className: 'page-description' }, 'View and manage appointments on the calendar')
            ),
            React.createElement('div', { className: 'flex items-center gap-4' },
              React.createElement('button', { className: 'btn btn-secondary btn-sm', onClick: () => navigateMonth(-1) }, React.createElement(Icons.ChevronLeft)),
              React.createElement('span', { className: 'text-lg font-semibold' }, `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`),
              React.createElement('button', { className: 'btn btn-secondary btn-sm', onClick: () => navigateMonth(1) }, React.createElement(Icons.ChevronRight)),
              React.createElement('button', { className: 'btn btn-primary btn-sm ml-4', onClick: goToToday }, 'Today')
            )
          ),
          React.createElement('div', { className: 'flex gap-6' },
            React.createElement('div', { className: 'flex-1' },
              React.createElement('div', { className: 'card calendar-grid-container' },
                React.createElement('div', { className: 'calendar-grid-header grid grid-cols-7' },
                  dayNames.map(day => React.createElement('div', { key: day, className: 'calendar-header-cell text-center font-semibold p-2' }, day))
                ),
                React.createElement('div', { className: 'calendar-grid grid grid-cols-7' }, dayElements)
              )
            ),
            React.createElement('div', { className: 'card calendar-details-panel', style: { width: '320px', minHeight: '400px' } },
              selectedDay ? React.createElement('div', null,
                React.createElement('div', { className: 'flex justify-between items-center mb-4 p-4 border-b' },
                  React.createElement('h4', { className: 'font-semibold' }, `${monthNames[currentDate.getMonth()]} ${selectedDay}, ${currentDate.getFullYear()}`),
                  React.createElement('button', { className: 'btn btn-secondary btn-sm', onClick: () => setSelectedDay(null) }, React.createElement(Icons.Close))
                ),
                selectedAppointments.length === 0 ?
                  React.createElement('div', { className: 'empty-state p-6' },
                    React.createElement(Icons.Calendar),
                    React.createElement('p', { className: 'empty-state-description mt-4' }, 'No appointments scheduled')
                  ) :
                  React.createElement('div', { className: 'p-4 space-y-3' },
                    selectedAppointments.map((apt, idx) =>
                      React.createElement('div', { key: idx, className: 'calendar-appointment-item p-3 rounded-lg border' },
                        React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                          React.createElement('div', null,
                            React.createElement('div', { className: 'font-semibold' }, apt.ServiceType || 'Appointment'),
                            React.createElement('div', { className: 'text-sm text-gray-500' }, `${formatTime(apt.StartTime)} - ${formatTime(apt.EndTime)}`)
                          ),
                          React.createElement('span', { className: `badge ${apt.Status === 'booked' ? 'badge-primary' : apt.Status === 'fulfilled' ? 'badge-success' : 'badge-gray'}` }, apt.Status || 'unknown')
                        ),
                        React.createElement('div', { className: 'text-sm text-gray-600 mb-2' },
                          React.createElement('div', null, `Patient: ${apt.PatientReference || 'N/A'}`),
                          React.createElement('div', null, `Provider: ${apt.PractitionerReference || 'N/A'}`)
                        ),
                        React.createElement('div', { className: 'flex gap-2 mt-2' },
                          React.createElement('button', {
                            className: 'btn btn-primary btn-sm flex-1',
                            onClick: () => onEditAppointment && onEditAppointment(apt.Id)
                          }, React.createElement(Icons.Edit), ' Edit')
                        )
                      )
                    )
                  )
              ) : React.createElement('div', { className: 'empty-state p-6' },
                React.createElement(Icons.Calendar),
                React.createElement('h4', { className: 'empty-state-title mt-4' }, 'Select a Day'),
                React.createElement('p', { className: 'empty-state-description' }, 'Click on a day to view appointments')
              )
            )
          )
        );
      };

      // Edit Appointment Page
      const EditAppointmentPage = ({ appointmentId, onCancel }) => {
        const [appointment, setAppointment] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [saving, setSaving] = React.useState(false);
        const [error, setError] = React.useState(null);
        const [success, setSuccess] = React.useState(null);
        const [formData, setFormData] = React.useState({
          ServiceCategory: '',
          ServiceType: '',
          ReasonCode: '',
          Priority: '',
          Description: '',
          Start: '',
          End: '',
          PatientReference: '',
          PractitionerReference: '',
          Comment: '',
          Status: ''
        });

        React.useEffect(() => {
          const fetchAppointment = async () => {
            try {
              const response = await fetch(`${SCHEDULING_API}/Appointment/${appointmentId}`);
              if (!response.ok) throw new Error('Failed to load appointment');
              const data = await response.json();
              setAppointment(data);
              setFormData({
                ServiceCategory: data.ServiceCategory || '',
                ServiceType: data.ServiceType || '',
                ReasonCode: data.ReasonCode || '',
                Priority: data.Priority || 'routine',
                Description: data.Description || '',
                Start: data.Start || data.StartTime || '',
                End: data.End || data.EndTime || '',
                PatientReference: data.PatientReference || '',
                PractitionerReference: data.PractitionerReference || '',
                Comment: data.Comment || '',
                Status: data.Status || 'booked'
              });
            } catch (err) {
              setError(err.message);
            } finally {
              setLoading(false);
            }
          };
          fetchAppointment();
        }, [appointmentId]);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSaving(true);
          setError(null);
          setSuccess(null);
          try {
            const response = await fetch(`${SCHEDULING_API}/Appointment/${appointmentId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });
            if (!response.ok) throw new Error('Failed to update appointment');
            const updated = await response.json();
            setAppointment(updated);
            setSuccess('Appointment updated successfully');
          } catch (err) {
            setError(err.message);
          } finally {
            setSaving(false);
          }
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
          setError(null);
          setSuccess(null);
        };

        if (loading) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Appointment'),
              React.createElement('p', { className: 'page-description' }, 'Loading appointment data...')
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'flex items-center justify-center p-8' }, 'Loading...')
            )
          );
        }

        if (error && !appointment) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Appointment'),
              React.createElement('p', { className: 'page-description' }, 'Error loading appointment')
            ),
            React.createElement('div', { className: 'card', style: { borderLeft: '4px solid var(--error)' } },
              React.createElement('div', { className: 'flex items-center gap-3 p-4' },
                React.createElement(Icons.AlertCircle),
                `Error loading appointment: ${error}. Use the sidebar to navigate.`
              )
            )
          );
        }

        return React.createElement('div', { className: 'page', 'data-testid': 'edit-appointment-page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Edit Appointment'),
            React.createElement('p', { className: 'page-description' }, `Update details for ${formData.ServiceType || 'appointment'}`)
          ),
          React.createElement('div', { className: 'card' },
            error && React.createElement('div', { className: 'alert alert-error mb-4' },
              React.createElement(Icons.AlertCircle), ` ${error}`
            ),
            success && React.createElement('div', { className: 'alert alert-success mb-4' },
              success
            ),
            React.createElement('form', { className: 'form', onSubmit: handleSubmit },
              // Service Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Service Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Service Category'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      id: 'appointment-service-category',
                      value: formData.ServiceCategory,
                      onChange: e => handleChange('ServiceCategory', e.target.value)
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Service Type'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      id: 'appointment-service-type',
                      value: formData.ServiceType,
                      onChange: e => handleChange('ServiceType', e.target.value)
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Priority'),
                    React.createElement('select', {
                      className: 'input',
                      value: formData.Priority,
                      onChange: e => handleChange('Priority', e.target.value)
                    },
                      React.createElement('option', { value: 'routine' }, 'Routine'),
                      React.createElement('option', { value: 'urgent' }, 'Urgent'),
                      React.createElement('option', { value: 'asap' }, 'ASAP'),
                      React.createElement('option', { value: 'stat' }, 'STAT')
                    )
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Status'),
                    React.createElement('select', {
                      className: 'input',
                      value: formData.Status,
                      onChange: e => handleChange('Status', e.target.value)
                    },
                      React.createElement('option', { value: 'booked' }, 'Booked'),
                      React.createElement('option', { value: 'arrived' }, 'Arrived'),
                      React.createElement('option', { value: 'fulfilled' }, 'Fulfilled'),
                      React.createElement('option', { value: 'cancelled' }, 'Cancelled'),
                      React.createElement('option', { value: 'noshow' }, 'No-show')
                    )
                  )
                )
              ),
              // Timing Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Timing'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Start Time'),
                    React.createElement('input', {
                      type: 'datetime-local',
                      className: 'input',
                      value: formData.Start ? formData.Start.substring(0, 16) : '',
                      onChange: e => handleChange('Start', e.target.value ? e.target.value + ':00.000Z' : '')
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'End Time'),
                    React.createElement('input', {
                      type: 'datetime-local',
                      className: 'input',
                      value: formData.End ? formData.End.substring(0, 16) : '',
                      onChange: e => handleChange('End', e.target.value ? e.target.value + ':00.000Z' : '')
                    })
                  )
                )
              ),
              // References Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'References'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Patient Reference'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.PatientReference,
                      onChange: e => handleChange('PatientReference', e.target.value),
                      placeholder: 'Patient/123'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Practitioner Reference'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.PractitionerReference,
                      onChange: e => handleChange('PractitionerReference', e.target.value),
                      placeholder: 'Practitioner/456'
                    })
                  )
                )
              ),
              // Additional Info Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Additional Information'),
                React.createElement('div', { className: 'grid grid-cols-1 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Description'),
                    React.createElement('textarea', {
                      className: 'input',
                      rows: 2,
                      value: formData.Description,
                      onChange: e => handleChange('Description', e.target.value)
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Comment'),
                    React.createElement('textarea', {
                      className: 'input',
                      rows: 2,
                      value: formData.Comment,
                      onChange: e => handleChange('Comment', e.target.value)
                    })
                  )
                )
              ),
              // Form Actions
              React.createElement('div', { className: 'flex gap-4 justify-end' },
                React.createElement('button', {
                  type: 'button',
                  className: 'btn btn-secondary',
                  onClick: onCancel
                }, 'Cancel'),
                React.createElement('button', {
                  type: 'submit',
                  className: 'btn btn-primary',
                  disabled: saving
                }, saving ? 'Saving...' : 'Save Changes')
              )
            )
          )
        );
      };

      // Sync Dashboard Page - requires sync:admin permission
      const SyncPage = () => {
        const [statusFilter, setStatusFilter] = React.useState('all');
        const [serviceFilter, setServiceFilter] = React.useState('all');
        const [searchQuery, setSearchQuery] = React.useState('');
        const [refreshKey, setRefreshKey] = React.useState(0);
        const [syncServices, setSyncServices] = React.useState([]);
        const [syncRecords, setSyncRecords] = React.useState([]);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        // Fetch real sync status from APIs
        React.useEffect(() => {
          const fetchSyncData = async () => {
            setLoading(true);
            setError(null);
            try {
              // Fetch status from both services
              const [clinicalStatus, schedulingStatus, clinicalRecords, schedulingRecords] = await Promise.all([
                fetch(`${CLINICAL_API}/sync/status`).then(r => r.ok ? r.json() : { status: 'error', service: 'Clinical.Api', pendingCount: 0, failedCount: 0, lastSyncTime: null }),
                fetch(`${SCHEDULING_API}/sync/status`).then(r => r.ok ? r.json() : { status: 'error', service: 'Scheduling.Api', pendingCount: 0, failedCount: 0, lastSyncTime: null }),
                fetch(`${CLINICAL_API}/sync/records`).then(r => r.ok ? r.json() : { records: [], total: 0 }),
                fetch(`${SCHEDULING_API}/sync/records`).then(r => r.ok ? r.json() : { records: [], total: 0 })
              ]);

              setSyncServices([
                { id: 'clinical', name: 'Clinical.Api', url: CLINICAL_API, status: clinicalStatus.status || 'healthy', lastSync: clinicalStatus.lastSyncTime || new Date().toISOString(), recordCount: clinicalRecords.total || 0, pendingCount: clinicalStatus.pendingCount || 0, failedCount: clinicalStatus.failedCount || 0 },
                { id: 'scheduling', name: 'Scheduling.Api', url: SCHEDULING_API, status: schedulingStatus.status || 'healthy', lastSync: schedulingStatus.lastSyncTime || new Date().toISOString(), recordCount: schedulingRecords.total || 0, pendingCount: schedulingStatus.pendingCount || 0, failedCount: schedulingStatus.failedCount || 0 }
              ]);

              // Combine records from both services
              const allRecords = [
                ...(clinicalRecords.records || []).map(r => ({ ...r, service: 'clinical' })),
                ...(schedulingRecords.records || []).map(r => ({ ...r, service: 'scheduling' }))
              ];
              setSyncRecords(allRecords);
            } catch (err) {
              console.error('[Sync] Error fetching sync data:', err);
              setError('Failed to fetch sync data. Services may be unavailable.');
              setSyncServices([]);
              setSyncRecords([]);
            } finally {
              setLoading(false);
            }
          };
          fetchSyncData();
        }, [refreshKey]);

        const filteredRecords = syncRecords.filter(record => {
          const matchesStatus = statusFilter === 'all' || record.status === statusFilter;
          const matchesService = serviceFilter === 'all' || record.service === serviceFilter;
          const matchesSearch = searchQuery === '' ||
            record.id.toLowerCase().includes(searchQuery.toLowerCase()) ||
            record.entityId.toLowerCase().includes(searchQuery.toLowerCase()) ||
            record.entityType.toLowerCase().includes(searchQuery.toLowerCase());
          return matchesStatus && matchesService && matchesSearch;
        });

        const getStatusIcon = (status) => {
          switch (status) {
            case 'synced': return React.createElement(Icons.CheckCircle);
            case 'pending': return React.createElement(Icons.Clock);
            case 'failed': return React.createElement(Icons.XCircle);
            case 'conflict': return React.createElement(Icons.AlertCircle);
            default: return React.createElement(Icons.Clock);
          }
        };

        const getStatusClass = (status) => {
          switch (status) {
            case 'synced': return 'status-success';
            case 'pending': return 'status-warning';
            case 'failed': return 'status-error';
            case 'conflict': return 'status-error';
            default: return '';
          }
        };

        const handleRetry = async (recordId, service) => {
          console.log('[Sync] Retry requested for record:', recordId, 'service:', service);
          const apiUrl = service === 'clinical' ? CLINICAL_API : SCHEDULING_API;
          try {
            const response = await fetch(`${apiUrl}/sync/records/${recordId}/retry`, { method: 'POST' });
            if (response.ok) {
              setRefreshKey(prev => prev + 1);
            } else {
              console.error('[Sync] Retry failed:', response.status);
            }
          } catch (err) {
            console.error('[Sync] Retry error:', err);
          }
        };

        const handleRefresh = () => {
          setRefreshKey(prev => prev + 1);
          console.log('[Sync] Refreshing sync status...');
        };

        const formatTime = (isoString) => {
          const date = new Date(isoString);
          return date.toLocaleTimeString();
        };

        return React.createElement('div', { className: 'page', 'data-testid': 'sync-page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' } },
              React.createElement('div', null,
                React.createElement('h2', { className: 'page-title' }, 'Sync Dashboard'),
                React.createElement('p', { className: 'page-description' }, 'Monitor and manage sync operations across microservices')
              ),
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: handleRefresh,
                disabled: loading,
                'data-testid': 'refresh-sync-btn'
              },
                React.createElement(Icons.RefreshCw),
                loading ? ' Loading...' : ' Refresh'
              )
            )
          ),

          // Error message
          error && React.createElement('div', { className: 'alert alert-error', style: { marginBottom: '24px' } }, error),

          // Loading state
          loading && React.createElement('div', { className: 'card', style: { marginBottom: '24px', textAlign: 'center', padding: '40px' } },
            React.createElement('p', null, 'Loading sync data...')
          ),

          // Service Status Cards
          !loading && React.createElement('div', { className: 'metrics-grid', style: { marginBottom: '24px' } },
            syncServices.length === 0
              ? React.createElement('div', { className: 'metric-card' },
                  React.createElement('div', { className: 'metric-value' }, 'No services available'),
                  React.createElement('div', { className: 'metric-label' }, 'Services may be offline')
                )
              : syncServices.map(service =>
              React.createElement('div', {
                key: service.id,
                className: 'metric-card',
                'data-testid': `service-status-${service.id}`
              },
                React.createElement('div', { className: 'metric-header' },
                  React.createElement('div', { className: 'metric-icon' },
                    React.createElement(Icons.Database)
                  ),
                  React.createElement('span', {
                    className: `status-badge ${service.status === 'healthy' ? 'status-success' : 'status-error'}`
                  }, service.status)
                ),
                React.createElement('div', { className: 'metric-value' }, service.name),
                React.createElement('div', { className: 'metric-label' },
                  `${service.recordCount.toLocaleString()} records • Last sync: ${formatTime(service.lastSync)}`
                )
              )
            )
          ),

          // Filters
          React.createElement('div', { className: 'card', style: { marginBottom: '24px' } },
            React.createElement('div', { className: 'card-header' },
              React.createElement('h3', { className: 'card-title' },
                React.createElement(Icons.Filter),
                ' Filters'
              )
            ),
            React.createElement('div', { className: 'card-body', style: { display: 'flex', gap: '16px', flexWrap: 'wrap' } },
              React.createElement('div', { className: 'form-group', style: { minWidth: '200px' } },
                React.createElement('label', { className: 'form-label' }, 'Status'),
                React.createElement('select', {
                  className: 'input',
                  value: statusFilter,
                  onChange: e => setStatusFilter(e.target.value),
                  'data-testid': 'status-filter'
                },
                  React.createElement('option', { value: 'all' }, 'All Statuses'),
                  React.createElement('option', { value: 'synced' }, 'Synced'),
                  React.createElement('option', { value: 'pending' }, 'Pending'),
                  React.createElement('option', { value: 'failed' }, 'Failed'),
                  React.createElement('option', { value: 'conflict' }, 'Conflict')
                )
              ),
              React.createElement('div', { className: 'form-group', style: { minWidth: '200px' } },
                React.createElement('label', { className: 'form-label' }, 'Service'),
                React.createElement('select', {
                  className: 'input',
                  value: serviceFilter,
                  onChange: e => setServiceFilter(e.target.value),
                  'data-testid': 'service-filter'
                },
                  React.createElement('option', { value: 'all' }, 'All Services'),
                  React.createElement('option', { value: 'clinical' }, 'Clinical.Api'),
                  React.createElement('option', { value: 'scheduling' }, 'Scheduling.Api')
                )
              ),
              React.createElement('div', { className: 'form-group', style: { minWidth: '300px', flex: 1 } },
                React.createElement('label', { className: 'form-label' }, 'Search'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Search by ID, entity type...',
                  value: searchQuery,
                  onChange: e => setSearchQuery(e.target.value),
                  'data-testid': 'sync-search'
                })
              )
            )
          ),

          // Sync Records Table
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('h3', { className: 'card-title' },
                React.createElement(Icons.Sync),
                ' Sync Records'
              ),
              React.createElement('span', { className: 'badge' }, `${filteredRecords.length} records`)
            ),
            React.createElement('div', { className: 'table-container' },
              React.createElement('table', { className: 'table', 'data-testid': 'sync-records-table' },
                React.createElement('thead', null,
                  React.createElement('tr', null,
                    React.createElement('th', null, 'Status'),
                    React.createElement('th', null, 'Record ID'),
                    React.createElement('th', null, 'Service'),
                    React.createElement('th', null, 'Entity'),
                    React.createElement('th', null, 'Last Attempt'),
                    React.createElement('th', null, 'Error'),
                    React.createElement('th', null, 'Actions')
                  )
                ),
                React.createElement('tbody', null,
                  filteredRecords.map(record =>
                    React.createElement('tr', { key: record.id, 'data-testid': `sync-record-${record.id}` },
                      React.createElement('td', null,
                        React.createElement('span', { className: `status-indicator ${getStatusClass(record.status)}` },
                          getStatusIcon(record.status),
                          ' ',
                          record.status
                        )
                      ),
                      React.createElement('td', null, record.id),
                      React.createElement('td', null, record.service === 'clinical' ? 'Clinical.Api' : 'Scheduling.Api'),
                      React.createElement('td', null, `${record.entityType} (${record.entityId})`),
                      React.createElement('td', null, formatTime(record.lastAttempt)),
                      React.createElement('td', null,
                        record.error ? React.createElement('span', { className: 'text-error', title: record.error },
                          record.error.substring(0, 30) + (record.error.length > 30 ? '...' : '')
                        ) : '-'
                      ),
                      React.createElement('td', null,
                        (record.status === 'failed' || record.status === 'conflict') &&
                          React.createElement('button', {
                            className: 'btn btn-sm btn-secondary',
                            onClick: () => handleRetry(record.id, record.service),
                            'data-testid': `retry-${record.id}`
                          },
                            React.createElement(Icons.RefreshCw),
                            ' Retry'
                          )
                      )
                    )
                  )
                )
              )
            ),
            filteredRecords.length === 0 && React.createElement('div', { className: 'empty-state', 'data-testid': 'sync-empty-state' },
              React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.CheckCircle)),
              React.createElement('h4', { className: 'empty-state-title' }, syncRecords.length === 0 ? 'No sync records' : 'No matching records'),
              React.createElement('p', { className: 'empty-state-description' }, syncRecords.length === 0 ? 'No data has been synced yet. Create some records to see sync activity.' : 'Adjust your filters to see sync records.')
            )
          )
        );
      };

      // Login Page Component - WebAuthn Passkey Authentication
      const LoginPage = ({ onLogin }) => {
        const [mode, setMode] = React.useState('login');
        const [email, setEmail] = React.useState('');
        const [displayName, setDisplayName] = React.useState('');
        const [loading, setLoading] = React.useState(false);
        const [error, setError] = React.useState(null);
        const [success, setSuccess] = React.useState(null);

        const base64UrlEncode = (buffer) => {
          const bytes = new Uint8Array(buffer);
          let binary = '';
          for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
          return btoa(binary).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, '');
        };

        const base64UrlDecode = (str) => {
          str = str.replace(/-/g, '+').replace(/_/g, '/');
          while (str.length % 4) str += '=';
          const binary = atob(str);
          const bytes = new Uint8Array(binary.length);
          for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
          return bytes.buffer;
        };

        const handleRegister = async (e) => {
          e.preventDefault();
          setLoading(true); setError(null); setSuccess(null);
          try {
            const beginRes = await fetch(`${GATEKEEPER_API}/auth/register/begin`, {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ Email: email, DisplayName: displayName })
            });
            if (!beginRes.ok) throw new Error((await beginRes.json()).Error || 'Registration failed');
            const beginData = await beginRes.json();
            const opts = JSON.parse(beginData.OptionsJson);
            opts.challenge = base64UrlDecode(opts.challenge);
            opts.user.id = base64UrlDecode(opts.user.id);
            if (opts.excludeCredentials) opts.excludeCredentials = opts.excludeCredentials.map(c => ({ ...c, id: base64UrlDecode(c.id) }));
            // Server already sets residentKey=required, don't override authenticatorSelection
            // Longer timeout for Chrome (2 minutes)
            opts.timeout = 120000;
            const cred = await navigator.credentials.create({ publicKey: opts });
            // fido2-net-lib expects specific JSON property names (camelCase with uppercase JSON)
            const attestation = {
              id: base64UrlEncode(cred.rawId), rawId: base64UrlEncode(cred.rawId), type: cred.type,
              response: { attestationObject: base64UrlEncode(cred.response.attestationObject), clientDataJSON: base64UrlEncode(cred.response.clientDataJSON) }
            };
            const completeRes = await fetch(`${GATEKEEPER_API}/auth/register/complete`, {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ ChallengeId: beginData.ChallengeId, OptionsJson: beginData.OptionsJson, AttestationResponse: attestation })
            });
            if (!completeRes.ok) throw new Error((await completeRes.json()).Error || 'Registration failed');
            setSuccess('Registration successful! You can now login.'); setMode('login');
          } catch (err) { setError(err.message); } finally { setLoading(false); }
        };

        const handleLogin = async (e) => {
          e.preventDefault();
          setLoading(true); setError(null);
          try {
            // Use discoverable credentials - no email needed!
            // The browser will prompt user to select from stored passkeys
            const beginRes = await fetch(`${GATEKEEPER_API}/auth/login/begin`, {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({})
            });
            if (!beginRes.ok) throw new Error((await beginRes.json()).Error || 'Login failed');
            const beginData = await beginRes.json();
            const opts = JSON.parse(beginData.OptionsJson);
            opts.challenge = base64UrlDecode(opts.challenge);
            // For discoverable credentials, remove allowCredentials entirely
            // This lets the browser show ALL stored passkeys for this origin (RP domain)
            // With resident keys, the passkey contains the user identity
            delete opts.allowCredentials;
            // Longer timeout for Chrome (2 minutes)
            opts.timeout = 120000;
            const assertion = await navigator.credentials.get({ publicKey: opts });
            // fido2-net-lib expects specific JSON property names (camelCase with uppercase JSON)
            const assertionData = {
              id: base64UrlEncode(assertion.rawId), rawId: base64UrlEncode(assertion.rawId), type: assertion.type,
              response: {
                authenticatorData: base64UrlEncode(assertion.response.authenticatorData),
                clientDataJSON: base64UrlEncode(assertion.response.clientDataJSON),
                signature: base64UrlEncode(assertion.response.signature),
                userHandle: assertion.response.userHandle ? base64UrlEncode(assertion.response.userHandle) : null
              }
            };
            const completeRes = await fetch(`${GATEKEEPER_API}/auth/login/complete`, {
              method: 'POST', headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ ChallengeId: beginData.ChallengeId, OptionsJson: beginData.OptionsJson, AssertionResponse: assertionData })
            });
            if (!completeRes.ok) throw new Error((await completeRes.json()).Error || 'Login failed');
            const result = await completeRes.json();
            setAuthToken(result.Token);
            setAuthUser({ userId: result.UserId, displayName: result.DisplayName, email: result.Email });
            onLogin({ userId: result.UserId, displayName: result.DisplayName, email: result.Email });
          } catch (err) { setError(err.message); } finally { setLoading(false); }
        };

        return React.createElement('div', { className: 'login-page', 'data-testid': 'login-page' },
          React.createElement('div', { className: 'login-card' },
            React.createElement('div', { className: 'login-header' },
              React.createElement('div', { className: 'login-logo' }, React.createElement(Icons.Activity)),
              React.createElement('h1', null, 'Healthcare Dashboard'),
              React.createElement('p', null, mode === 'login' ? 'Sign in with your passkey' : 'Create your account')
            ),
            error && React.createElement('div', { className: 'login-error' }, error),
            success && React.createElement('div', { className: 'login-success' }, success),
            React.createElement('form', { onSubmit: mode === 'login' ? handleLogin : handleRegister },
              mode === 'register' && React.createElement('div', { className: 'form-group' },
                React.createElement('label', { htmlFor: 'email' }, 'Email'),
                React.createElement('input', { type: 'email', id: 'email', value: email, onChange: (e) => setEmail(e.target.value), placeholder: 'you@example.com', required: true, disabled: loading })
              ),
              mode === 'register' && React.createElement('div', { className: 'form-group' },
                React.createElement('label', { htmlFor: 'displayName' }, 'Display Name'),
                React.createElement('input', { type: 'text', id: 'displayName', value: displayName, onChange: (e) => setDisplayName(e.target.value), placeholder: 'Your Name', required: true, disabled: loading })
              ),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary login-btn', disabled: loading },
                loading ? 'Please wait...' : (mode === 'login' ? 'Sign in with Passkey' : 'Register with Passkey'))
            ),
            React.createElement('div', { className: 'login-footer' },
              mode === 'login'
                ? React.createElement('p', null, "Don't have an account? ", React.createElement('button', { type: 'button', className: 'link-btn', onClick: () => { setMode('register'); setError(null); setSuccess(null); } }, 'Register'))
                : React.createElement('p', null, 'Already have an account? ', React.createElement('button', { type: 'button', className: 'link-btn', onClick: () => { setMode('login'); setError(null); setSuccess(null); } }, 'Sign in'))
            )
          )
        );
      };

      // Sidebar Component
      const Sidebar = ({ activeView, onNavigate, collapsed, onToggle, currentUser, onLogout }) => {
        const navSections = [
          { title: 'Overview', items: [{ id: 'dashboard', label: 'Dashboard', icon: Icons.Home }] },
          { title: 'Clinical', items: [
            { id: 'patients', label: 'Patients', icon: Icons.Users },
            { id: 'encounters', label: 'Encounters', icon: Icons.Clipboard },
            { id: 'conditions', label: 'Conditions', icon: Icons.Activity }
          ]},
          { title: 'Scheduling', items: [
            { id: 'practitioners', label: 'Practitioners', icon: Icons.UserDoctor },
            { id: 'appointments', label: 'Appointments', icon: Icons.Clipboard },
            { id: 'calendar', label: 'Schedule', icon: Icons.Calendar }
          ]},
          { title: 'Administration', items: [
            { id: 'sync', label: 'Sync Dashboard', icon: Icons.Sync }
          ]}
        ];

        // Get user initials for avatar
        const getInitials = (name) => {
          if (!name) return '??';
          const parts = name.trim().split(/\s+/);
          if (parts.length >= 2) return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
          return name.slice(0, 2).toUpperCase();
        };

        const userName = currentUser?.displayName || currentUser?.email || 'User';
        const userInitials = getInitials(userName);

        return React.createElement('aside', { className: `sidebar ${collapsed ? 'collapsed' : ''}` },
          React.createElement('div', { className: 'sidebar-header' },
            React.createElement('a', { className: 'sidebar-logo', href: '#' },
              React.createElement('div', { className: 'sidebar-logo-icon' },
                React.createElement(Icons.Activity)
              ),
              React.createElement('span', { className: 'sidebar-logo-text' }, 'Healthcare')
            )
          ),
          React.createElement('nav', { className: 'sidebar-nav' },
            navSections.map(section =>
              React.createElement('div', { key: section.title, className: 'nav-section' },
                React.createElement('div', { className: 'nav-section-title' }, section.title),
                section.items.map(item =>
                  React.createElement('a', {
                    key: item.id,
                    className: `nav-item ${activeView === item.id ? 'active' : ''}`,
                    onClick: () => onNavigate(item.id)
                  },
                    React.createElement('span', { className: 'nav-item-icon' }, React.createElement(item.icon)),
                    React.createElement('span', { className: 'nav-item-text' }, item.label)
                  )
                )
              )
            )
          ),
          React.createElement('button', { className: 'sidebar-toggle', onClick: onToggle },
            collapsed ? React.createElement(Icons.ChevronRight) : React.createElement(Icons.ChevronLeft)
          ),
          React.createElement('div', { className: 'sidebar-footer' },
            React.createElement('div', { className: 'sidebar-user' },
              React.createElement('div', { className: 'avatar avatar-sm' }, userInitials),
              React.createElement('div', { className: 'sidebar-user-info' },
                React.createElement('div', { className: 'sidebar-user-name' }, userName),
                React.createElement('div', { className: 'sidebar-user-role' }, currentUser?.email || 'Authenticated')
              )
            ),
            React.createElement('button', {
              className: 'btn btn-secondary btn-sm sidebar-logout-btn',
              onClick: onLogout,
              title: 'Sign out',
              'data-testid': 'logout-button'
            },
              React.createElement(Icons.LogOut),
              !collapsed && React.createElement('span', null, 'Sign Out')
            )
          )
        );
      };

      // Header Component with User Dropdown
      const Header = ({ title, searchQuery, onSearchChange, currentUser, onLogout }) => {
        const [dropdownOpen, setDropdownOpen] = React.useState(false);

        // Get user initials
        const getInitials = (name) => {
          if (!name) return '??';
          const parts = name.trim().split(/\s+/);
          if (parts.length >= 2) return (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();
          return name.slice(0, 2).toUpperCase();
        };

        const userName = currentUser?.displayName || currentUser?.email || 'User';
        const userEmail = currentUser?.email || '';
        const userInitials = getInitials(userName);

        // Close dropdown when clicking outside
        React.useEffect(() => {
          const handleClickOutside = (e) => {
            if (dropdownOpen && !e.target.closest('.user-menu')) {
              setDropdownOpen(false);
            }
          };
          document.addEventListener('click', handleClickOutside);
          return () => document.removeEventListener('click', handleClickOutside);
        }, [dropdownOpen]);

        return React.createElement('header', { className: 'header' },
          React.createElement('div', { className: 'header-left' },
            React.createElement('h1', { className: 'header-title' }, title)
          ),
          React.createElement('div', { className: 'header-right' },
            React.createElement('div', { className: 'header-search' },
              React.createElement(Icons.Search),
              React.createElement('input', {
                type: 'text',
                className: 'input',
                placeholder: 'Search...',
                value: searchQuery,
                onChange: e => onSearchChange(e.target.value)
              })
            ),
            React.createElement('div', { className: 'header-actions' },
              React.createElement('button', { className: 'header-action-btn' },
                React.createElement(Icons.Bell),
                React.createElement('span', { className: 'header-action-badge' })
              ),
              React.createElement('div', { className: 'user-menu' },
                React.createElement('button', {
                  className: 'avatar avatar-md user-menu-trigger',
                  onClick: (e) => { e.stopPropagation(); setDropdownOpen(!dropdownOpen); },
                  'data-testid': 'user-menu-button'
                }, userInitials),
                dropdownOpen && React.createElement('div', { className: 'user-dropdown', 'data-testid': 'user-dropdown' },
                  React.createElement('div', { className: 'user-dropdown-header' },
                    React.createElement('div', { className: 'user-dropdown-name' }, userName),
                    React.createElement('div', { className: 'user-dropdown-email' }, userEmail)
                  ),
                  React.createElement('div', { className: 'user-dropdown-divider' }),
                  React.createElement('button', {
                    className: 'user-dropdown-item user-dropdown-logout',
                    onClick: (e) => { e.stopPropagation(); onLogout(); },
                    'data-testid': 'logout-button'
                  },
                    React.createElement(Icons.LogOut),
                    React.createElement('span', null, 'Sign Out')
                  )
                )
              )
            )
          )
        );
      };

      // Edit Patient Page
      const EditPatientPage = ({ patientId, onCancel }) => {
        const [patient, setPatient] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [saving, setSaving] = React.useState(false);
        const [error, setError] = React.useState(null);
        const [success, setSuccess] = React.useState(null);
        const [formData, setFormData] = React.useState({
          Active: true,
          GivenName: '',
          FamilyName: '',
          BirthDate: '',
          Gender: '',
          Phone: '',
          Email: '',
          AddressLine: '',
          City: '',
          State: '',
          PostalCode: '',
          Country: ''
        });

        React.useEffect(() => {
          const fetchPatient = async () => {
            try {
              const response = await fetch(`${CLINICAL_API}/fhir/Patient/${patientId}`);
              if (!response.ok) throw new Error('Failed to load patient');
              const data = await response.json();
              setPatient(data);
              setFormData({
                Active: data.Active !== false,
                GivenName: data.GivenName || '',
                FamilyName: data.FamilyName || '',
                BirthDate: data.BirthDate || '',
                Gender: data.Gender || '',
                Phone: data.Phone || '',
                Email: data.Email || '',
                AddressLine: data.AddressLine || '',
                City: data.City || '',
                State: data.State || '',
                PostalCode: data.PostalCode || '',
                Country: data.Country || ''
              });
            } catch (err) {
              setError(err.message);
            } finally {
              setLoading(false);
            }
          };
          fetchPatient();
        }, [patientId]);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSaving(true);
          setError(null);
          setSuccess(null);
          try {
            const response = await fetch(`${CLINICAL_API}/fhir/Patient/${patientId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });
            if (!response.ok) throw new Error('Failed to update patient');
            const updated = await response.json();
            setPatient(updated);
            setSuccess('Patient updated successfully!');
          } catch (err) {
            setError(err.message);
          } finally {
            setSaving(false);
          }
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
          setError(null);
          setSuccess(null);
        };

        if (loading) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Patient'),
              React.createElement('p', { className: 'page-description' }, 'Loading patient data...')
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'flex items-center justify-center p-8' }, 'Loading...')
            )
          );
        }

        if (error && !patient) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Patient'),
              React.createElement('p', { className: 'page-description' }, 'Error loading patient')
            ),
            React.createElement('div', { className: 'card', style: { borderLeft: '4px solid var(--error)' } },
              React.createElement('div', { className: 'flex items-center gap-3 p-4' },
                React.createElement(Icons.AlertCircle),
                `Error loading patient: ${error}. Use the sidebar to navigate.`
              )
            )
          );
        }

        const fullName = `${formData.GivenName} ${formData.FamilyName}`.trim();

        return React.createElement('div', { className: 'page', 'data-testid': 'edit-patient-page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Edit Patient'),
            React.createElement('p', { className: 'page-description' }, `Update information for ${fullName || 'patient'}`)
          ),
          React.createElement('div', { className: 'card' },
            error && React.createElement('div', { className: 'alert alert-error mb-4', 'data-testid': 'edit-error' },
              React.createElement(Icons.AlertCircle), ` ${error}`
            ),
            success && React.createElement('div', { className: 'alert alert-success mb-4', 'data-testid': 'edit-success' },
              success
            ),
            React.createElement('form', { className: 'form', onSubmit: handleSubmit },
              // Personal Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Personal Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Given Name'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.GivenName,
                      onChange: e => handleChange('GivenName', e.target.value),
                      'data-testid': 'edit-given-name'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Family Name'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.FamilyName,
                      onChange: e => handleChange('FamilyName', e.target.value),
                      'data-testid': 'edit-family-name'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Birth Date'),
                    React.createElement('input', {
                      type: 'date',
                      className: 'input',
                      value: formData.BirthDate,
                      onChange: e => handleChange('BirthDate', e.target.value),
                      'data-testid': 'edit-birth-date'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Gender'),
                    React.createElement('select', {
                      className: 'input',
                      value: formData.Gender,
                      onChange: e => handleChange('Gender', e.target.value),
                      'data-testid': 'edit-gender'
                    },
                      React.createElement('option', { value: '' }, 'Select gender'),
                      React.createElement('option', { value: 'male' }, 'Male'),
                      React.createElement('option', { value: 'female' }, 'Female'),
                      React.createElement('option', { value: 'other' }, 'Other'),
                      React.createElement('option', { value: 'unknown' }, 'Unknown')
                    )
                  )
                )
              ),
              // Contact Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Contact Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Phone'),
                    React.createElement('input', {
                      type: 'tel',
                      className: 'input',
                      value: formData.Phone,
                      onChange: e => handleChange('Phone', e.target.value),
                      'data-testid': 'edit-phone'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Email'),
                    React.createElement('input', {
                      type: 'email',
                      className: 'input',
                      value: formData.Email,
                      onChange: e => handleChange('Email', e.target.value),
                      'data-testid': 'edit-email'
                    })
                  )
                )
              ),
              // Address Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Address'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Address Line'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.AddressLine,
                      onChange: e => handleChange('AddressLine', e.target.value),
                      'data-testid': 'edit-address'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'City'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.City,
                      onChange: e => handleChange('City', e.target.value),
                      'data-testid': 'edit-city'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'State'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.State,
                      onChange: e => handleChange('State', e.target.value),
                      'data-testid': 'edit-state'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Postal Code'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.PostalCode,
                      onChange: e => handleChange('PostalCode', e.target.value),
                      'data-testid': 'edit-postal-code'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Country'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.Country,
                      onChange: e => handleChange('Country', e.target.value),
                      'data-testid': 'edit-country'
                    })
                  )
                )
              ),
              // Form Actions
              React.createElement('div', { className: 'form-actions flex justify-end gap-4 mt-6' },
                React.createElement('button', {
                  type: 'button',
                  className: 'btn btn-secondary',
                  onClick: onCancel,
                  disabled: saving
                }, 'Cancel'),
                React.createElement('button', {
                  type: 'submit',
                  className: 'btn btn-primary',
                  disabled: saving,
                  'data-testid': 'save-patient'
                }, saving ? 'Saving...' : 'Save Changes')
              )
            )
          )
        );
      };

      // Edit Practitioner Page
      const EditPractitionerPage = ({ practitionerId, onCancel }) => {
        const [practitioner, setPractitioner] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [saving, setSaving] = React.useState(false);
        const [error, setError] = React.useState(null);
        const [success, setSuccess] = React.useState(null);
        const [formData, setFormData] = React.useState({
          Identifier: '',
          Active: true,
          NameGiven: '',
          NameFamily: '',
          Qualification: 'MD',
          Specialty: '',
          TelecomEmail: '',
          TelecomPhone: ''
        });

        React.useEffect(() => {
          const fetchPractitioner = async () => {
            try {
              const response = await fetch(`${SCHEDULING_API}/Practitioner/${practitionerId}`);
              if (!response.ok) throw new Error('Failed to load practitioner');
              const data = await response.json();
              setPractitioner(data);
              setFormData({
                Identifier: data.Identifier || '',
                Active: data.Active !== false && data.Active !== 0,
                NameGiven: data.NameGiven || '',
                NameFamily: data.NameFamily || '',
                Qualification: data.Qualification || 'MD',
                Specialty: data.Specialty || '',
                TelecomEmail: data.TelecomEmail || '',
                TelecomPhone: data.TelecomPhone || ''
              });
            } catch (err) {
              setError(err.message);
            } finally {
              setLoading(false);
            }
          };
          fetchPractitioner();
        }, [practitionerId]);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSaving(true);
          setError(null);
          setSuccess(null);
          try {
            const response = await fetch(`${SCHEDULING_API}/Practitioner/${practitionerId}`, {
              method: 'PUT',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(formData)
            });
            if (!response.ok) throw new Error('Failed to update practitioner');
            const updated = await response.json();
            setPractitioner(updated);
            setSuccess('Practitioner updated successfully!');
          } catch (err) {
            setError(err.message);
          } finally {
            setSaving(false);
          }
        };

        const handleChange = (field, value) => {
          setFormData(prev => ({ ...prev, [field]: value }));
          setError(null);
          setSuccess(null);
        };

        if (loading) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Practitioner'),
              React.createElement('p', { className: 'page-description' }, 'Loading practitioner data...')
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'flex items-center justify-center p-8' }, 'Loading...')
            )
          );
        }

        if (error && !practitioner) {
          return React.createElement('div', { className: 'page' },
            React.createElement('div', { className: 'page-header' },
              React.createElement('h2', { className: 'page-title' }, 'Edit Practitioner'),
              React.createElement('p', { className: 'page-description' }, 'Error loading practitioner')
            ),
            React.createElement('div', { className: 'card', style: { borderLeft: '4px solid var(--error)' } },
              React.createElement('div', { className: 'flex items-center gap-3 p-4' },
                React.createElement(Icons.AlertCircle),
                `Error loading practitioner: ${error}. Use the sidebar to navigate.`
              )
            )
          );
        }

        const fullName = `${formData.NameGiven} ${formData.NameFamily}`.trim();

        return React.createElement('div', { className: 'page', 'data-testid': 'edit-practitioner-page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Edit Practitioner'),
            React.createElement('p', { className: 'page-description' }, `Update information for ${fullName || 'practitioner'}`)
          ),
          React.createElement('div', { className: 'card' },
            error && React.createElement('div', { className: 'alert alert-error mb-4', 'data-testid': 'edit-practitioner-error' },
              React.createElement(Icons.AlertCircle), ` ${error}`
            ),
            success && React.createElement('div', { className: 'alert alert-success mb-4', 'data-testid': 'edit-practitioner-success' },
              success
            ),
            React.createElement('form', { className: 'form', onSubmit: handleSubmit },
              // Basic Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Basic Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Identifier'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.Identifier,
                      onChange: e => handleChange('Identifier', e.target.value),
                      'data-testid': 'edit-practitioner-identifier'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Active'),
                    React.createElement('select', {
                      className: 'input',
                      value: formData.Active ? 'true' : 'false',
                      onChange: e => handleChange('Active', e.target.value === 'true'),
                      'data-testid': 'edit-practitioner-active'
                    },
                      React.createElement('option', { value: 'true' }, 'Active'),
                      React.createElement('option', { value: 'false' }, 'Inactive')
                    )
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Given Name'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.NameGiven,
                      onChange: e => handleChange('NameGiven', e.target.value),
                      'data-testid': 'edit-practitioner-given-name'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Family Name'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.NameFamily,
                      onChange: e => handleChange('NameFamily', e.target.value),
                      'data-testid': 'edit-practitioner-family-name'
                    })
                  )
                )
              ),
              // Professional Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Professional Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Qualification'),
                    React.createElement('select', {
                      className: 'input',
                      value: formData.Qualification,
                      onChange: e => handleChange('Qualification', e.target.value),
                      'data-testid': 'edit-practitioner-qualification'
                    },
                      React.createElement('option', { value: 'MD' }, 'MD - Doctor of Medicine'),
                      React.createElement('option', { value: 'DO' }, 'DO - Doctor of Osteopathy'),
                      React.createElement('option', { value: 'NP' }, 'NP - Nurse Practitioner'),
                      React.createElement('option', { value: 'PA' }, 'PA - Physician Assistant'),
                      React.createElement('option', { value: 'RN' }, 'RN - Registered Nurse')
                    )
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Specialty'),
                    React.createElement('input', {
                      type: 'text',
                      className: 'input',
                      value: formData.Specialty,
                      onChange: e => handleChange('Specialty', e.target.value),
                      'data-testid': 'edit-practitioner-specialty'
                    })
                  )
                )
              ),
              // Contact Information Section
              React.createElement('div', { className: 'form-section mb-6' },
                React.createElement('h4', { className: 'form-section-title mb-4' }, 'Contact Information'),
                React.createElement('div', { className: 'grid grid-cols-2 gap-4' },
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Email'),
                    React.createElement('input', {
                      type: 'email',
                      className: 'input',
                      value: formData.TelecomEmail,
                      onChange: e => handleChange('TelecomEmail', e.target.value),
                      'data-testid': 'edit-practitioner-email'
                    })
                  ),
                  React.createElement('div', { className: 'form-group' },
                    React.createElement('label', { className: 'form-label' }, 'Phone'),
                    React.createElement('input', {
                      type: 'tel',
                      className: 'input',
                      value: formData.TelecomPhone,
                      onChange: e => handleChange('TelecomPhone', e.target.value),
                      'data-testid': 'edit-practitioner-phone'
                    })
                  )
                )
              ),
              // Form Actions
              React.createElement('div', { className: 'form-actions flex justify-end gap-4 mt-6' },
                React.createElement('button', {
                  type: 'button',
                  className: 'btn btn-secondary',
                  onClick: onCancel,
                  disabled: saving
                }, 'Cancel'),
                React.createElement('button', {
                  type: 'submit',
                  className: 'btn btn-primary',
                  disabled: saving,
                  'data-testid': 'save-practitioner'
                }, saving ? 'Saving...' : 'Save Changes')
              )
            )
          )
        );
      };

      // Main App Component
      const App = () => {
        // Test mode bypass - allows E2E tests to skip authentication
        // Check URL params or window config for test mode
        const isTestMode = () => {
          const urlParams = new URLSearchParams(window.location.search);
          return urlParams.get('testMode') === 'true' || window.dashboardConfig?.testMode === true;
        };

        // Auth state - check localStorage on mount (or bypass in test mode)
        const [isAuthenticated, setIsAuthenticated] = React.useState(() => isTestMode() || !!getAuthToken());
        const [currentUser, setCurrentUser] = React.useState(() => isTestMode() ? { userId: 'test', displayName: 'Test User', email: 'test@example.com' } : getAuthUser());

        const handleLogin = (user) => {
          setCurrentUser(user);
          setIsAuthenticated(true);
        };

        // Parse initial state from URL hash for deep linking support
        const parseHashRoute = () => {
          const hash = window.location.hash.slice(1); // Remove #
          if (!hash) return { view: 'dashboard', patientId: null, practitionerId: null, appointmentId: null };
          const parts = hash.split('/');
          if (parts[0] === 'patients' && parts[1] === 'edit' && parts[2]) {
            return { view: 'patients', patientId: parts[2], practitionerId: null, appointmentId: null };
          }
          if (parts[0] === 'practitioners' && parts[1] === 'edit' && parts[2]) {
            return { view: 'practitioners', patientId: null, practitionerId: parts[2], appointmentId: null };
          }
          if (parts[0] === 'appointments' && parts[1] === 'edit' && parts[2]) {
            return { view: 'appointments', patientId: null, practitionerId: null, appointmentId: parts[2] };
          }
          return { view: parts[0] || 'dashboard', patientId: null, practitionerId: null, appointmentId: null };
        };

        const initialRoute = parseHashRoute();

        // ALL HOOKS MUST BE DECLARED BEFORE ANY CONDITIONAL RETURNS (React Rules of Hooks)
        const [activeView, setActiveViewState] = React.useState(initialRoute.view);
        const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false);
        const [searchQuery, setSearchQuery] = React.useState('');
        const [navigationOptions, setNavigationOptions] = React.useState({});
        const [editingPatientId, setEditingPatientIdState] = React.useState(initialRoute.patientId);
        const [editingPractitionerId, setEditingPractitionerIdState] = React.useState(initialRoute.practitionerId);
        const [editingAppointmentId, setEditingAppointmentIdState] = React.useState(initialRoute.appointmentId);

        // Expose login trigger for E2E testing (allows tests to simulate successful WebAuthn)
        React.useEffect(() => {
          window.__triggerLogin = handleLogin;
          return () => { delete window.__triggerLogin; };
        }, []);

        // Listen for browser back/forward buttons (popstate event)
        React.useEffect(() => {
          const handlePopState = (event) => {
            if (event.state) {
              setActiveViewState(event.state.view || 'dashboard');
              setEditingPatientIdState(event.state.patientId || null);
              setEditingPractitionerIdState(event.state.practitionerId || null);
              setEditingAppointmentIdState(event.state.appointmentId || null);
            } else {
              // No state - parse from hash (handles direct URL entry)
              const route = parseHashRoute();
              setActiveViewState(route.view);
              setEditingPatientIdState(route.patientId);
              setEditingPractitionerIdState(route.practitionerId);
              setEditingAppointmentIdState(route.appointmentId);
            }
          };
          window.addEventListener('popstate', handlePopState);
          // Set initial state in history
          if (!window.history.state) {
            window.history.replaceState(initialRoute, '', window.location.hash || '#dashboard');
          }
          return () => window.removeEventListener('popstate', handlePopState);
        }, []);

        // Clear navigation options after page renders
        React.useEffect(() => {
          if (Object.keys(navigationOptions).length > 0) {
            const timer = setTimeout(() => setNavigationOptions({}), 100);
            return () => clearTimeout(timer);
          }
        }, [navigationOptions]);

        const handleLogout = async () => {
          // Call Gatekeeper to revoke the token server-side
          const token = getAuthToken();
          if (token) {
            try {
              await fetch(`${GATEKEEPER_API}/auth/logout`, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${token}` }
              });
            } catch (err) {
              console.warn('[Auth] Logout request failed (token may already be expired):', err);
            }
          }
          // Clear local storage regardless of server response
          clearAuth();
          setCurrentUser(null);
          setIsAuthenticated(false);
        };

        // Update URL hash when navigation changes (pushes to browser history)
        const updateUrlHash = (view, editId = null, editType = null) => {
          const newHash = editId ? `#${view}/edit/${editId}` : `#${view}`;
          if (window.location.hash !== newHash) {
            window.history.pushState({ view, patientId: editType === 'patient' ? editId : null, practitionerId: editType === 'practitioner' ? editId : null }, '', newHash);
          }
        };

        // Wrapper to update state AND URL hash together
        const setActiveView = (view) => {
          setActiveViewState(view);
          updateUrlHash(view);
        };

        const setEditingPatientId = (patientId) => {
          setEditingPatientIdState(patientId);
          if (patientId) {
            updateUrlHash('patients', patientId, 'patient');
          }
        };

        const setEditingPractitionerId = (practitionerId) => {
          setEditingPractitionerIdState(practitionerId);
          if (practitionerId) {
            updateUrlHash('practitioners', practitionerId, 'practitioner');
          }
        };

        const setEditingAppointmentId = (appointmentId) => {
          setEditingAppointmentIdState(appointmentId);
          if (appointmentId) {
            updateUrlHash('appointments', appointmentId, 'appointment');
          }
        };

        // Navigation handler that supports options
        const handleNavigate = (view, options = {}) => {
          setActiveViewState(view);
          setNavigationOptions(options);
          setEditingPatientIdState(null); // Clear editing state when navigating
          setEditingPractitionerIdState(null);
          setEditingAppointmentIdState(null);
          updateUrlHash(view);
        };

        // If not authenticated, show login page
        if (!isAuthenticated) {
          return React.createElement(LoginPage, { onLogin: handleLogin });
        }

        const getPageTitle = () => {
          if (editingPatientId) return 'Edit Patient';
          if (editingPractitionerId) return 'Edit Practitioner';
          if (editingAppointmentId) return 'Edit Appointment';
          return {
            dashboard: 'Dashboard',
            patients: 'Patients',
            encounters: 'Encounters',
            conditions: 'Conditions',
            practitioners: 'Practitioners',
            appointments: 'Appointments',
            calendar: 'Schedule',
            sync: 'Sync Dashboard',
            settings: 'Settings'
          }[activeView] || 'Healthcare';
        };

        const handleEditPatient = (patientId) => {
          setEditingPatientIdState(patientId);
          updateUrlHash('patients', patientId, 'patient');
        };

        const handleEditPractitioner = (practitionerId) => {
          setEditingPractitionerIdState(practitionerId);
          updateUrlHash('practitioners', practitionerId, 'practitioner');
        };

        const handleEditAppointment = (appointmentId) => {
          setEditingAppointmentIdState(appointmentId);
          updateUrlHash('appointments', appointmentId, 'appointment');
        };

        // Use history.back() so browser back button and in-app cancel behave the same
        const handleCancelEdit = () => {
          window.history.back();
        };

        const renderPage = () => {
          // Handle editing patient
          if (activeView === 'patients' && editingPatientId) {
            return React.createElement(EditPatientPage, {
              patientId: editingPatientId,
              onCancel: handleCancelEdit
            });
          }

          // Handle editing practitioner
          if (activeView === 'practitioners' && editingPractitionerId) {
            return React.createElement(EditPractitionerPage, {
              practitionerId: editingPractitionerId,
              onCancel: handleCancelEdit
            });
          }

          // Handle editing appointment
          if (activeView === 'appointments' && editingAppointmentId) {
            return React.createElement(EditAppointmentPage, {
              appointmentId: editingAppointmentId,
              onCancel: handleCancelEdit
            });
          }

          switch (activeView) {
            case 'dashboard': return React.createElement(DashboardPage, { onNavigate: handleNavigate });
            case 'patients': return React.createElement(PatientsPage, {
              openAddModal: navigationOptions.openAddModal,
              onEditPatient: handleEditPatient
            });
            case 'practitioners': return React.createElement(PractitionersPage, {
              openAddModal: navigationOptions.openAddModal,
              onEditPractitioner: handleEditPractitioner
            });
            case 'appointments': return React.createElement(AppointmentsPage, {
              openAddModal: navigationOptions.openAddModal,
              onEditAppointment: handleEditAppointment
            });
            case 'calendar': return React.createElement(CalendarPage, { onEditAppointment: handleEditAppointment });
            case 'encounters': return React.createElement(PlaceholderPage, { title: 'Encounters', description: 'Manage patient encounters and visits' });
            case 'conditions': return React.createElement(PlaceholderPage, { title: 'Conditions', description: 'View and manage patient conditions' });
            case 'sync': return React.createElement(SyncPage);
            default: return React.createElement(PlaceholderPage, { title: 'Page Not Found', description: 'The requested page does not exist' });
          }
        };

        return React.createElement('div', { className: 'app' },
          React.createElement(Sidebar, {
            activeView,
            onNavigate: setActiveView,
            collapsed: sidebarCollapsed,
            onToggle: () => setSidebarCollapsed(!sidebarCollapsed),
            currentUser,
            onLogout: handleLogout
          }),
          React.createElement('div', { className: 'main-wrapper' },
            React.createElement(Header, {
              title: getPageTitle(),
              searchQuery,
              onSearchChange: setSearchQuery,
              currentUser,
              onLogout: handleLogout
            }),
            React.createElement('main', { className: 'main-content' }, renderPage())
          )
        );
      };

      // Export App for testing
      window.App = App;

    // Render the app
    console.log('[Dashboard] Mounting React application...');
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
    console.log('[Dashboard] Application ready!');
  </script>
</body>
</html>
