<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Healthcare Dashboard - Clinical and Scheduling Management">
  <title>Healthcare Dashboard</title>

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%232ca3fa' width='100' height='100' rx='20'/%3E%3Cpath fill='white' d='M50 20v60M20 50h60' stroke='white' stroke-width='12' stroke-linecap='round'/%3E%3C/svg%3E">

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/layout.css">

  <!-- Google Charts -->
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <!-- React (local bundle for offline/test support) -->
  <script src="js/vendor/react.development.js"></script>
  <script src="js/vendor/react-dom.development.js"></script>

  <style>
    /* Loading screen */
    .loading-screen {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-blue-subtle) 0%, var(--teal-soft) 50%, var(--white) 100%);
      z-index: 9999;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .loading-screen.hidden {
      opacity: 0;
      visibility: hidden;
    }

    .loading-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--teal-bold) 100%);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
      animation: pulse 2s ease-in-out infinite;
    }

    .loading-logo svg {
      width: 48px;
      height: 48px;
    }

    .loading-text {
      font-size: 18px;
      font-weight: 500;
      color: var(--gray-700);
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--gray-200);
      border-top-color: var(--primary-blue);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-top: 24px;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loading-screen">
    <div class="loading-logo">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
      </svg>
    </div>
    <div class="loading-text">Healthcare Dashboard</div>
    <div class="loading-spinner"></div>
  </div>

  <!-- React Root -->
  <div id="root"></div>

  <!-- H5 Generated JavaScript - DISABLED: has broken React hooks (calls useState from static method) -->
  <!-- <script src="js/Dashboard.js"></script> -->

  <!-- Pure JS React Dashboard -->
  <script>
    // Hide loading screen after a delay
    setTimeout(function() {
      document.getElementById('loading-screen').classList.add('hidden');
    }, 1500);

    // Load Google Charts
    google.charts.load('current', {
      'packages': ['corechart', 'line', 'bar', 'gauge']
    });

    // Flag to track when charts are ready
    let googleChartsLoaded = false;
    google.charts.setOnLoadCallback(() => {
      googleChartsLoaded = true;
      console.log('[Dashboard] Google Charts loaded!');
    });

    // Load the React dashboard
    console.log('[Dashboard] Loading React dashboard...');

      // API Configuration
      const CLINICAL_API = window.dashboardConfig?.CLINICAL_API_URL || 'http://localhost:5080';
      const SCHEDULING_API = window.dashboardConfig?.SCHEDULING_API_URL || 'http://localhost:5001';

      // API helper
      const fetchApi = async (url) => {
        try {
          const response = await fetch(url, {
            headers: { 'Accept': 'application/json' }
          });
          if (!response.ok) throw new Error(`HTTP ${response.status}`);
          return await response.json();
        } catch (error) {
          console.error(`[API Error] ${url}:`, error);
          throw error;
        }
      };

      // Custom hooks
      const useFetch = (url, dependencies = []) => {
        const [data, setData] = React.useState(null);
        const [loading, setLoading] = React.useState(true);
        const [error, setError] = React.useState(null);

        React.useEffect(() => {
          let mounted = true;
          setLoading(true);
          fetchApi(url)
            .then(result => { if (mounted) { setData(result); setError(null); } })
            .catch(err => { if (mounted) setError(err.message); })
            .finally(() => { if (mounted) setLoading(false); });
          return () => { mounted = false; };
        }, dependencies);

        return { data, loading, error };
      };

      // POST API helper
      const postApi = async (url, data) => {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
          body: JSON.stringify(data)
        });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        return await response.json();
      };

      // Icons as SVG components
      const Icons = {
        Home: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z' }),
          React.createElement('polyline', { points: '9,22 9,12 15,12 15,22' })
        ),
        Users: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2' }),
          React.createElement('circle', { cx: 9, cy: 7, r: 4 }),
          React.createElement('path', { d: 'M23 21v-2a4 4 0 00-3-3.87' }),
          React.createElement('path', { d: 'M16 3.13a4 4 0 010 7.75' })
        ),
        UserDoctor: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2' }),
          React.createElement('circle', { cx: 12, cy: 7, r: 4 }),
          React.createElement('line', { x1: 12, y1: 11, x2: 12, y2: 17 }),
          React.createElement('line', { x1: 9, y1: 14, x2: 15, y2: 14 })
        ),
        Calendar: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('rect', { x: 3, y: 4, width: 18, height: 18, rx: 2, ry: 2 }),
          React.createElement('line', { x1: 16, y1: 2, x2: 16, y2: 6 }),
          React.createElement('line', { x1: 8, y1: 2, x2: 8, y2: 6 }),
          React.createElement('line', { x1: 3, y1: 10, x2: 21, y2: 10 })
        ),
        Clipboard: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2' }),
          React.createElement('rect', { x: 8, y: 2, width: 8, height: 4, rx: 1, ry: 1 })
        ),
        Search: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 11, cy: 11, r: 8 }),
          React.createElement('line', { x1: 21, y1: 21, x2: 16.65, y2: 16.65 })
        ),
        Bell: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('path', { d: 'M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9' }),
          React.createElement('path', { d: 'M13.73 21a2 2 0 01-3.46 0' })
        ),
        ChevronLeft: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '15,18 9,12 15,6' })
        ),
        ChevronRight: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '9,6 15,12 9,18' })
        ),
        Activity: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '22,12 18,12 15,21 9,3 6,12 2,12' })
        ),
        AlertCircle: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('circle', { cx: 12, cy: 12, r: 10 }),
          React.createElement('line', { x1: 12, y1: 8, x2: 12, y2: 12 }),
          React.createElement('line', { x1: 12, y1: 16, x2: 12.01, y2: 16 })
        ),
        TrendUp: () => React.createElement('svg', { className: 'icon icon-sm', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '23,6 13.5,15.5 8.5,10.5 1,18' }),
          React.createElement('polyline', { points: '17,6 23,6 23,12' })
        ),
        TrendDown: () => React.createElement('svg', { className: 'icon icon-sm', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('polyline', { points: '23,18 13.5,8.5 8.5,13.5 1,6' }),
          React.createElement('polyline', { points: '17,18 23,18 23,12' })
        ),
        Close: () => React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2 },
          React.createElement('line', { x1: 18, y1: 6, x2: 6, y2: 18 }),
          React.createElement('line', { x1: 6, y1: 6, x2: 18, y2: 18 })
        )
      };

      // Modal Component
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null;
        return React.createElement('div', { className: 'modal-backdrop open', onClick: onClose },
          React.createElement('div', { className: 'modal', onClick: e => e.stopPropagation() },
            React.createElement('div', { className: 'modal-header' },
              React.createElement('h3', { className: 'modal-title' }, title),
              React.createElement('button', { className: 'modal-close', onClick: onClose },
                React.createElement(Icons.Close)
              )
            ),
            children
          )
        );
      };

      // Add Patient Modal Component
      const AddPatientModal = ({ isOpen, onClose, onSuccess }) => {
        const [formData, setFormData] = React.useState({ GivenName: '', FamilyName: '', Gender: 'other', Active: true });
        const [submitting, setSubmitting] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSubmitting(true);
          setError(null);
          try {
            await postApi(`${CLINICAL_API}/fhir/Patient/`, formData);
            setFormData({ GivenName: '', FamilyName: '', Gender: 'other', Active: true });
            onSuccess();
            onClose();
          } catch (err) {
            setError(err.message);
          } finally {
            setSubmitting(false);
          }
        };

        return React.createElement(Modal, { isOpen, onClose, title: 'Add New Patient' },
          React.createElement('form', { onSubmit: handleSubmit },
            React.createElement('div', { className: 'modal-body' },
              error && React.createElement('div', { className: 'alert alert-error mb-4' }, error),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Given Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter given name',
                  value: formData.GivenName,
                  onChange: e => setFormData({ ...formData, GivenName: e.target.value }),
                  required: true,
                  'data-testid': 'patient-given-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Family Name'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Enter family name',
                  value: formData.FamilyName,
                  onChange: e => setFormData({ ...formData, FamilyName: e.target.value }),
                  required: true,
                  'data-testid': 'patient-family-name'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Gender'),
                React.createElement('select', {
                  className: 'input',
                  value: formData.Gender,
                  onChange: e => setFormData({ ...formData, Gender: e.target.value }),
                  'data-testid': 'patient-gender'
                },
                  React.createElement('option', { value: 'male' }, 'Male'),
                  React.createElement('option', { value: 'female' }, 'Female'),
                  React.createElement('option', { value: 'other' }, 'Other')
                )
              )
            ),
            React.createElement('div', { className: 'modal-footer' },
              React.createElement('button', { type: 'button', className: 'btn btn-secondary', onClick: onClose }, 'Cancel'),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: submitting, 'data-testid': 'submit-patient' },
                submitting ? 'Saving...' : 'Add Patient'
              )
            )
          )
        );
      };

      // Add Appointment Modal Component
      const AddAppointmentModal = ({ isOpen, onClose, onSuccess }) => {
        const [formData, setFormData] = React.useState({
          ServiceCategory: 'General',
          ServiceType: 'Checkup',
          Priority: 'routine',
          PatientReference: 'Patient/1',
          PractitionerReference: 'Practitioner/1',
          Start: new Date().toISOString().slice(0, 16),
          End: new Date(Date.now() + 3600000).toISOString().slice(0, 16)
        });
        const [submitting, setSubmitting] = React.useState(false);
        const [error, setError] = React.useState(null);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setSubmitting(true);
          setError(null);
          try {
            await postApi(`${SCHEDULING_API}/Appointment`, {
              ...formData,
              Start: new Date(formData.Start).toISOString(),
              End: new Date(formData.End).toISOString()
            });
            onSuccess();
            onClose();
          } catch (err) {
            setError(err.message);
          } finally {
            setSubmitting(false);
          }
        };

        return React.createElement(Modal, { isOpen, onClose, title: 'New Appointment' },
          React.createElement('form', { onSubmit: handleSubmit },
            React.createElement('div', { className: 'modal-body' },
              error && React.createElement('div', { className: 'alert alert-error mb-4' }, error),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Service Type'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Checkup, Consultation',
                  value: formData.ServiceType,
                  onChange: e => setFormData({ ...formData, ServiceType: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-service-type'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Patient Reference'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Patient/1',
                  value: formData.PatientReference,
                  onChange: e => setFormData({ ...formData, PatientReference: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-patient-ref'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Practitioner Reference'),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'e.g. Practitioner/1',
                  value: formData.PractitionerReference,
                  onChange: e => setFormData({ ...formData, PractitionerReference: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-practitioner-ref'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Start Time'),
                React.createElement('input', {
                  type: 'datetime-local',
                  className: 'input',
                  value: formData.Start,
                  onChange: e => setFormData({ ...formData, Start: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-start'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'End Time'),
                React.createElement('input', {
                  type: 'datetime-local',
                  className: 'input',
                  value: formData.End,
                  onChange: e => setFormData({ ...formData, End: e.target.value }),
                  required: true,
                  'data-testid': 'appointment-end'
                })
              ),
              React.createElement('div', { className: 'input-group mb-4' },
                React.createElement('label', { className: 'input-label' }, 'Priority'),
                React.createElement('select', {
                  className: 'input',
                  value: formData.Priority,
                  onChange: e => setFormData({ ...formData, Priority: e.target.value }),
                  'data-testid': 'appointment-priority'
                },
                  React.createElement('option', { value: 'routine' }, 'Routine'),
                  React.createElement('option', { value: 'urgent' }, 'Urgent'),
                  React.createElement('option', { value: 'asap' }, 'ASAP'),
                  React.createElement('option', { value: 'stat' }, 'STAT')
                )
              )
            ),
            React.createElement('div', { className: 'modal-footer' },
              React.createElement('button', { type: 'button', className: 'btn btn-secondary', onClick: onClose }, 'Cancel'),
              React.createElement('button', { type: 'submit', className: 'btn btn-primary', disabled: submitting, 'data-testid': 'submit-appointment' },
                submitting ? 'Saving...' : 'Create Appointment'
              )
            )
          )
        );
      };

      // Metric Card Component
      const MetricCard = ({ label, value, icon, iconColor, trend, trendValue, loading }) => (
        React.createElement('div', { className: 'metric-card' },
          React.createElement('div', { className: `metric-icon ${iconColor}` }, icon),
          React.createElement('div', { className: 'metric-value' }, loading ? '-' : value),
          React.createElement('div', { className: 'metric-label' }, label),
          trendValue && React.createElement('div', { className: `metric-trend ${trend}` },
            trend === 'up' ? React.createElement(Icons.TrendUp) : React.createElement(Icons.TrendDown),
            ' ', trendValue
          )
        )
      );

      // Data Table Component
      const DataTable = ({ columns, data, loading, onRowClick }) => {
        if (loading) {
          return React.createElement('div', { className: 'table-container' },
            React.createElement('div', { className: 'skeleton-rows' },
              [...Array(5)].map((_, i) => React.createElement('div', { key: i, className: 'skeleton', style: { height: '48px', marginBottom: '8px' } }))
            )
          );
        }
        if (!data || data.length === 0) {
          return React.createElement('div', { className: 'empty-state' },
            React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.Clipboard)),
            React.createElement('h4', { className: 'empty-state-title' }, 'No Data'),
            React.createElement('p', { className: 'empty-state-description' }, 'No records found')
          );
        }
        return React.createElement('div', { className: 'table-container' },
          React.createElement('table', { className: 'table' },
            React.createElement('thead', null,
              React.createElement('tr', null,
                columns.map(col => React.createElement('th', { key: col.key }, col.header))
              )
            ),
            React.createElement('tbody', null,
              data.map((row, i) =>
                React.createElement('tr', {
                  key: row.Id || row.id || i,
                  className: onRowClick ? 'cursor-pointer' : '',
                  onClick: onRowClick ? () => onRowClick(row) : undefined
                },
                  columns.map(col =>
                    React.createElement('td', { key: col.key }, col.render ? col.render(row) : row[col.key])
                  )
                )
              )
            )
          )
        );
      };

      // Mini Sparkline Chart Component
      const Sparkline = ({ data, color = 'var(--primary-blue)', height = 40 }) => {
        const max = Math.max(...data);
        const min = Math.min(...data);
        const range = max - min || 1;
        const width = 100;
        const points = data.map((v, i) => `${(i / (data.length - 1)) * width},${height - ((v - min) / range) * height}`).join(' ');
        return React.createElement('svg', { viewBox: `0 0 ${width} ${height}`, style: { width: '100%', height: `${height}px` }, preserveAspectRatio: 'none' },
          React.createElement('polyline', { fill: 'none', stroke: color, strokeWidth: 2, points }),
          React.createElement('polyline', { fill: `${color}20`, stroke: 'none', points: `0,${height} ${points} ${width},${height}` })
        );
      };

      // Donut Chart Component
      const DonutChart = ({ value, max = 100, size = 80, strokeWidth = 8, color = 'var(--primary-blue)' }) => {
        const radius = (size - strokeWidth) / 2;
        const circumference = 2 * Math.PI * radius;
        const percent = Math.min(value / max, 1);
        const offset = circumference * (1 - percent);
        return React.createElement('svg', { width: size, height: size, style: { transform: 'rotate(-90deg)' } },
          React.createElement('circle', { cx: size/2, cy: size/2, r: radius, fill: 'none', stroke: 'var(--gray-200)', strokeWidth }),
          React.createElement('circle', { cx: size/2, cy: size/2, r: radius, fill: 'none', stroke: color, strokeWidth, strokeDasharray: circumference, strokeDashoffset: offset, strokeLinecap: 'round' })
        );
      };

      // Bar Chart Component
      const BarChart = ({ data, height = 120 }) => {
        const max = Math.max(...data.map(d => d.value));
        return React.createElement('div', { className: 'bar-chart', style: { display: 'flex', alignItems: 'flex-end', gap: '8px', height: `${height}px` } },
          data.map((d, i) => React.createElement('div', { key: i, className: 'bar-chart-item', style: { flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '4px' } },
            React.createElement('div', {
              className: 'bar',
              style: {
                width: '100%',
                height: `${(d.value / max) * 100}%`,
                background: `linear-gradient(to top, ${d.color || 'var(--primary-blue)'}, ${d.colorLight || 'var(--primary-blue-subtle)'})`,
                borderRadius: '4px 4px 0 0',
                minHeight: '4px'
              }
            }),
            React.createElement('span', { style: { fontSize: '10px', color: 'var(--gray-500)' } }, d.label)
          ))
        );
      };

      // Google Area Chart Component
      const GoogleAreaChart = ({ data, title, height = 200, colors = ['#3b82f6', '#14b8a6'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' }, baselineColor: '#e5e7eb' }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, baselineColor: '#e5e7eb', minValue: 0 }, legend: { position: 'top', alignment: 'end', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors, areaOpacity: 0.15, lineWidth: 3, pointSize: 0, curveType: 'function', chartArea: { left: 50, top: 40, width: '85%', height: '70%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.AreaChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Pie/Donut Chart Component
      const GooglePieChart = ({ data, title, height = 200, colors, pieHole = 0.5 }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, pieHole: pieHole, pieSliceTextStyle: { color: '#ffffff', fontSize: 11, fontName: 'Inter' }, legend: { position: 'right', alignment: 'center', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors || ['#3b82f6', '#14b8a6', '#22c55e', '#f59e0b', '#f97316', '#8b5cf6'], chartArea: { left: 20, top: 30, width: '90%', height: '80%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.PieChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors, pieHole]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Column Chart Component
      const GoogleColumnChart = ({ data, title, height = 200, colors = ['#14b8a6'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' } }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, minValue: 0 }, legend: { position: 'none' }, colors: colors, bar: { groupWidth: '60%' }, chartArea: { left: 50, top: 30, width: '85%', height: '70%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.ColumnChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Google Line Chart Component
      const GoogleLineChart = ({ data, title, height = 200, colors = ['#3b82f6', '#14b8a6', '#f97316'] }) => {
        const chartRef = React.useRef(null);
        const [chartReady, setChartReady] = React.useState(false);
        React.useEffect(() => {
          if (!googleChartsLoaded || !chartRef.current) {
            const checkInterval = setInterval(() => { if (googleChartsLoaded && chartRef.current) { clearInterval(checkInterval); setChartReady(true); } }, 100);
            return () => clearInterval(checkInterval);
          }
          setChartReady(true);
        }, []);
        React.useEffect(() => {
          if (!chartReady || !chartRef.current || !data) return;
          const chartData = google.visualization.arrayToDataTable(data);
          const options = { title: title || '', titleTextStyle: { color: '#374151', fontSize: 14, fontName: 'Inter', bold: false }, hAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: 'transparent' } }, vAxis: { textStyle: { color: '#9ca3af', fontSize: 11, fontName: 'Inter' }, gridlines: { color: '#f3f4f6' }, minValue: 0 }, legend: { position: 'top', alignment: 'end', textStyle: { color: '#6b7280', fontSize: 11, fontName: 'Inter' } }, colors: colors, lineWidth: 3, pointSize: 5, curveType: 'function', chartArea: { left: 50, top: 40, width: '85%', height: '65%' }, backgroundColor: 'transparent', animation: { startup: true, duration: 800, easing: 'out' } };
          const chart = new google.visualization.LineChart(chartRef.current);
          chart.draw(chartData, options);
        }, [chartReady, data, title, colors]);
        return React.createElement('div', { ref: chartRef, className: 'google-chart-container', style: { width: '100%', height: `${height}px`, minHeight: `${height}px` } });
      };

      // Calendar Date Picker Component
      const CalendarPicker = ({ selectedDate, onSelect }) => {
        const today = new Date();
        const [currentMonth] = React.useState(today.getMonth());
        const [currentYear] = React.useState(today.getFullYear());
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        const firstDay = new Date(currentYear, currentMonth, 1).getDay();
        const days = [];
        for (let i = 0; i < firstDay; i++) days.push(null);
        for (let i = 1; i <= daysInMonth; i++) days.push(i);

        return React.createElement('div', { className: 'calendar-picker' },
          React.createElement('div', { className: 'calendar-header' },
            React.createElement('span', { className: 'calendar-month' },
              new Date(currentYear, currentMonth).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })
            )
          ),
          React.createElement('div', { className: 'calendar-weekdays' },
            ['Su', 'Mo', 'Tu', 'We', 'Th', 'Fr', 'Sa'].map(d =>
              React.createElement('div', { key: d, className: 'calendar-weekday' }, d)
            )
          ),
          React.createElement('div', { className: 'calendar-days' },
            days.map((day, i) =>
              React.createElement('div', {
                key: i,
                className: `calendar-day ${day === today.getDate() ? 'today' : ''} ${day === selectedDate ? 'selected' : ''} ${!day ? 'empty' : ''}`,
                onClick: day ? () => onSelect(day) : undefined
              }, day)
            )
          )
        );
      };

      // Appointment Request Card
      const AppointmentRequestCard = ({ patient, type, time, onAccept, onReject }) => (
        React.createElement('div', { className: 'appointment-request' },
          React.createElement('div', { className: 'appointment-request-info' },
            React.createElement('div', { className: 'avatar avatar-md', style: { background: 'var(--teal-soft)', color: 'var(--teal-dark)' } },
              patient.split(' ').map(n => n[0]).join('')
            ),
            React.createElement('div', { className: 'appointment-request-details' },
              React.createElement('div', { className: 'appointment-request-name' }, patient),
              React.createElement('div', { className: 'appointment-request-type' }, type),
              React.createElement('div', { className: 'appointment-request-time' },
                React.createElement(Icons.Calendar),
                React.createElement('span', null, time)
              )
            )
          ),
          React.createElement('div', { className: 'appointment-request-actions' },
            React.createElement('button', { className: 'btn-icon-circle reject', onClick: onReject, title: 'Reject' }, 'Ã—'),
            React.createElement('button', { className: 'btn-icon-circle accept', onClick: onAccept, title: 'Accept' }, 'âœ“')
          )
        )
      );

      // Rich Metric Card with breakdown
      const RichMetricCard = ({ title, value, change, changeType, icon, breakdown, chart, loading }) => (
        React.createElement('div', { className: 'metric-card metric-card-rich' },
          React.createElement('div', { className: 'metric-card-header' },
            React.createElement('div', { className: 'metric-card-icon' }, icon),
            React.createElement('span', { className: 'metric-card-title' }, title),
            React.createElement('a', { href: '#', className: 'metric-card-link' }, 'View more')
          ),
          React.createElement('div', { className: 'metric-card-body' },
            React.createElement('div', { className: 'metric-card-value-row' },
              React.createElement('span', { className: 'metric-card-value' }, loading ? '-' : value),
              change && React.createElement('span', { className: `metric-card-change ${changeType}` }, change)
            ),
            breakdown && React.createElement('div', { className: 'metric-card-breakdown' },
              breakdown.map((item, i) =>
                React.createElement('span', { key: i, className: 'metric-breakdown-item' },
                  React.createElement('span', { className: 'metric-breakdown-dot', style: { background: item.color } }),
                  item.label
                )
              )
            ),
            chart
          )
        )
      );

      // Dashboard Page - Professional Healthcare Design
      const DashboardPage = ({ onNavigate }) => {
        const patients = useFetch(`${CLINICAL_API}/fhir/Patient`);
        const practitioners = useFetch(`${SCHEDULING_API}/Practitioner`);
        const appointments = useFetch(`${SCHEDULING_API}/Appointment`);
        const [selectedDate, setSelectedDate] = React.useState(new Date().getDate());

        const hasError = patients.error || practitioners.error || appointments.error;
        const isLoading = patients.loading || practitioners.loading || appointments.loading;

        // Sample data for charts
        const weeklyData = [35, 45, 38, 52, 48, 60, 55];
        const monthlyTrend = [120, 145, 132, 168, 155, 180, 175, 190, 185, 210, 198, 220];
        const treatmentBreakdown = [
          { label: 'Surgery', color: 'var(--primary-blue)' },
          { label: 'Consultation', color: 'var(--teal-bold)' },
          { label: 'Diagnosis', color: 'var(--success)' },
          { label: 'Biopsy', color: 'var(--warning)' }
        ];
        const revenueData = [
          { label: 'Jan', value: 120, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Feb', value: 180, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Mar', value: 150, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Apr', value: 220, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'May', value: 190, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' },
          { label: 'Jun', value: 250, color: 'var(--teal-bold)', colorLight: 'var(--teal-soft)' }
        ];

        // Mock upcoming appointments
        const upcomingAppointments = [
          { patient: 'Jane Cooper', treatment: 'Consultation', status: 'Confirmed', date: 'Mar. 22', time: '10:00AM' },
          { patient: 'Guy Hawkins', treatment: 'Diagnosis', status: 'Confirmed', date: 'Mar. 22', time: '11:00AM' },
          { patient: 'Cameron Williamson', treatment: 'Surgery', status: 'Confirmed', date: 'Mar. 22', time: '12:30PM' },
          { patient: 'Jerome Bell', treatment: 'Consultation', status: 'Confirmed', date: 'Mar. 22', time: '3:00PM' }
        ];

        // Mock appointment requests
        const appointmentRequests = [
          { patient: 'Jane Cooper', type: 'Individual consultation', time: '02 Apr, 10:00 am' },
          { patient: 'Albert Flores', type: 'Individual consultation', time: '04 Apr, 09:00 am' },
          { patient: 'Kristin Watson', type: 'Individual consultation', time: '04 Apr, 02:00 pm' }
        ];

        return React.createElement('div', { className: 'page dashboard-page' },
          // Welcome Header
          React.createElement('div', { className: 'dashboard-welcome' },
            React.createElement('h2', { className: 'welcome-title' }, 'Welcome back, Dr. Robert!'),
            React.createElement('div', { className: 'welcome-actions' },
              React.createElement('div', { className: 'date-filter' },
                React.createElement('span', null, 'Monthly'),
                React.createElement(Icons.Calendar)
              ),
              React.createElement('button', { className: 'btn btn-outline' }, 'Export data')
            )
          ),

          // Connection Warning
          hasError && React.createElement('div', { className: 'alert alert-warning mb-6' },
            React.createElement(Icons.AlertCircle),
            React.createElement('div', null,
              React.createElement('strong', null, 'Connection Warning'),
              React.createElement('p', null, 'Could not connect to API. Make sure Clinical API (port 5080) and Scheduling API (port 5001) are running.')
            )
          ),

          // Top Metrics Row
          React.createElement('div', { className: 'dashboard-metrics-row' },
            React.createElement(RichMetricCard, {
              title: 'Top Treatment',
              value: '580',
              change: '+24',
              changeType: 'up',
              icon: React.createElement(Icons.Activity),
              breakdown: treatmentBreakdown,
              loading: isLoading,
              chart: React.createElement('div', { className: 'donut-chart-container' },
                React.createElement('div', { className: 'donut-legend' },
                  [180, 240, 100, 60].map((v, i) =>
                    React.createElement('div', { key: i, className: 'donut-legend-item' },
                      React.createElement(DonutChart, { value: v, max: 580, size: i === 0 ? 70 : i === 1 ? 60 : 40, strokeWidth: 6, color: treatmentBreakdown[i].color }),
                      React.createElement('span', null, v)
                    )
                  )
                )
              )
            }),
            React.createElement(RichMetricCard, {
              title: 'Satisfaction Rate',
              value: '85%',
              change: '-2%',
              changeType: 'down',
              icon: React.createElement('span', { style: { fontSize: '20px' } }, 'ðŸ˜Š'),
              loading: isLoading,
              chart: React.createElement(Sparkline, { data: weeklyData, color: 'var(--primary-blue)', height: 50 })
            }),
            React.createElement(RichMetricCard, {
              title: 'Total Patients',
              value: patients.data?.length || 620,
              change: '+28',
              changeType: 'up',
              icon: React.createElement(Icons.Users),
              breakdown: [
                { label: 'Inpatient', color: 'var(--primary-blue)' },
                { label: 'Discharged', color: 'var(--gray-400)' },
                { label: 'Outpatient', color: 'var(--teal-bold)' }
              ],
              loading: isLoading,
              chart: React.createElement('div', { className: 'patient-breakdown-bars' },
                [420, 120, 80].map((v, i) =>
                  React.createElement('div', { key: i, className: 'breakdown-bar-item' },
                    React.createElement('span', { className: 'breakdown-bar-value' }, v),
                    React.createElement('div', { className: 'breakdown-bar', style: { width: `${(v/420)*100}%`, background: ['var(--primary-blue)', 'var(--gray-300)', 'var(--teal-bold)'][i] } })
                  )
                )
              )
            }),
            React.createElement(RichMetricCard, {
              title: 'Total Appointments',
              value: appointments.data?.length || 260,
              change: '+16',
              changeType: 'up',
              icon: React.createElement(Icons.Calendar),
              loading: isLoading,
              chart: React.createElement(Sparkline, { data: monthlyTrend, color: 'var(--teal-bold)', height: 50 })
            })
          ),

          // Main Content Grid
          React.createElement('div', { className: 'dashboard-main-grid' },
            // Left Column - Appointments Table
            React.createElement('div', { className: 'dashboard-appointments-section' },
              React.createElement('div', { className: 'card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-header-left' },
                    React.createElement(Icons.Calendar),
                    React.createElement('h3', { className: 'card-title' }, 'Upcoming Appointments')
                  ),
                  React.createElement('div', { className: 'appointment-legend' },
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot available' }), 'Available'),
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot selected' }), 'Selected'),
                    React.createElement('span', { className: 'legend-item' }, React.createElement('span', { className: 'legend-dot unavailable' }), 'Unavailable')
                  ),
                  React.createElement('a', { href: '#', className: 'view-more-link' }, 'View more')
                ),
                React.createElement('div', { className: 'card-body' },
                  // Calendar strip
                  React.createElement('div', { className: 'calendar-strip' },
                    React.createElement('button', { className: 'calendar-nav' }, React.createElement(Icons.ChevronLeft)),
                    [...Array(9)].map((_, i) => {
                      const day = 14 + i;
                      const isToday = day === 22;
                      const isSelected = day === selectedDate;
                      return React.createElement('button', {
                        key: i,
                        className: `calendar-day-btn ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''} ${[18, 19].includes(day) ? 'has-events' : ''}`,
                        onClick: () => setSelectedDate(day)
                      }, day);
                    }),
                    React.createElement('button', { className: 'calendar-nav' }, React.createElement(Icons.ChevronRight))
                  ),
                  // Appointments table
                  React.createElement('table', { className: 'appointments-table' },
                    React.createElement('thead', null,
                      React.createElement('tr', null,
                        React.createElement('th', null, 'Patient'),
                        React.createElement('th', null, 'Treatment'),
                        React.createElement('th', null, 'Status'),
                        React.createElement('th', null, 'Date'),
                        React.createElement('th', null, 'Time'),
                        React.createElement('th', null, 'Action')
                      )
                    ),
                    React.createElement('tbody', null,
                      (appointments.data || upcomingAppointments).slice(0, 5).map((apt, i) =>
                        React.createElement('tr', { key: i },
                          React.createElement('td', null,
                            React.createElement('div', { className: 'patient-cell' },
                              React.createElement('div', { className: 'avatar avatar-sm' },
                                (apt.patient || apt.PatientReference || 'JD').substring(0, 2)
                              ),
                              apt.patient || apt.PatientReference || 'Patient'
                            )
                          ),
                          React.createElement('td', null, apt.treatment || apt.ServiceType || 'Consultation'),
                          React.createElement('td', null,
                            React.createElement('span', { className: `status-badge ${(apt.status || apt.Status || 'confirmed').toLowerCase()}` },
                              'â€¢ ', apt.status || apt.Status || 'Confirmed'
                            )
                          ),
                          React.createElement('td', null, apt.date || (apt.Start ? new Date(apt.Start).toLocaleDateString() : 'Today')),
                          React.createElement('td', null, apt.time || (apt.Start ? new Date(apt.Start).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) : '10:00 AM')),
                          React.createElement('td', null,
                            React.createElement('div', { className: 'action-buttons' },
                              React.createElement('button', { className: 'btn-icon-sm call' }, 'ðŸ“ž'),
                              React.createElement('button', { className: 'btn-icon-sm more' }, 'â‹®')
                            )
                          )
                        )
                      )
                    )
                  )
                )
              )
            ),

            // Right Column - Appointment Requests
            React.createElement('div', { className: 'dashboard-requests-section' },
              React.createElement('div', { className: 'card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('div', { className: 'card-header-left' },
                    React.createElement(Icons.Calendar),
                    React.createElement('h3', { className: 'card-title' }, 'Appointment Requests')
                  ),
                  React.createElement('a', { href: '#', className: 'view-more-link' }, 'View more')
                ),
                React.createElement('div', { className: 'card-body requests-list' },
                  appointmentRequests.map((req, i) =>
                    React.createElement(AppointmentRequestCard, {
                      key: i,
                      patient: req.patient,
                      type: req.type,
                      time: req.time,
                      onAccept: () => console.log('Accept', req.patient),
                      onReject: () => console.log('Reject', req.patient)
                    })
                  )
                )
              ),

              // Quick Actions Card
              React.createElement('div', { className: 'card quick-actions-card' },
                React.createElement('div', { className: 'card-header' },
                  React.createElement('h3', { className: 'card-title' }, 'Quick Actions')
                ),
                React.createElement('div', { className: 'card-body' },
                  React.createElement('div', { className: 'quick-actions-grid' },
                    React.createElement('button', { className: 'quick-action-btn primary', onClick: () => onNavigate('patients', { openAddModal: true }), 'data-testid': 'quick-new-patient' },
                      React.createElement(Icons.Users),
                      React.createElement('span', null, '+ New Patient')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('appointments', { openAddModal: true }), 'data-testid': 'quick-new-appointment' },
                      React.createElement(Icons.Calendar),
                      React.createElement('span', null, '+ New Appointment')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('patients'), 'data-testid': 'quick-patient-search' },
                      React.createElement(Icons.Search),
                      React.createElement('span', null, 'Patient Search')
                    ),
                    React.createElement('button', { className: 'quick-action-btn', onClick: () => onNavigate('appointments'), 'data-testid': 'quick-view-schedule' },
                      React.createElement(Icons.Clipboard),
                      React.createElement('span', null, 'View Schedule')
                    )
                  )
                )
              )
            )
          ),

          // Google Charts Analytics Section
          React.createElement('div', { className: 'dashboard-charts-section' },
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Patient Activity Trends'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View details')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleAreaChart, {
                  data: [
                    ['Month', 'Outpatient', 'Inpatient'],
                    ['Jan', 120, 45], ['Feb', 145, 52], ['Mar', 132, 48],
                    ['Apr', 168, 61], ['May', 155, 58], ['Jun', 180, 65],
                    ['Jul', 175, 62], ['Aug', 190, 68], ['Sep', 185, 66],
                    ['Oct', 210, 72], ['Nov', 198, 70], ['Dec', 220, 78]
                  ],
                  height: 280,
                  colors: ['#3b82f6', '#14b8a6']
                })
              )
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Treatment Distribution'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View all')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GooglePieChart, {
                  data: [
                    ['Treatment', 'Count'],
                    ['Surgery', 180], ['Consultation', 240], ['Diagnosis', 100],
                    ['Biopsy', 60], ['Therapy', 85], ['Emergency', 45]
                  ],
                  height: 280,
                  colors: ['#3b82f6', '#14b8a6', '#22c55e', '#f59e0b', '#8b5cf6', '#f97316'],
                  pieHole: 0.5
                })
              )
            )
          ),

          // Additional Charts Row
          React.createElement('div', { className: 'dashboard-charts-section' },
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Monthly Revenue'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View report')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleColumnChart, {
                  data: [
                    ['Month', 'Revenue ($K)'],
                    ['Jan', 120], ['Feb', 180], ['Mar', 150],
                    ['Apr', 220], ['May', 190], ['Jun', 250]
                  ],
                  height: 250,
                  colors: ['#14b8a6']
                })
              )
            ),
            React.createElement('div', { className: 'card' },
              React.createElement('div', { className: 'card-header' },
                React.createElement('h3', { className: 'card-title' }, 'Appointment Completion Rate'),
                React.createElement('a', { href: '#', className: 'view-more-link' }, 'View analytics')
              ),
              React.createElement('div', { className: 'card-body' },
                React.createElement(GoogleLineChart, {
                  data: [
                    ['Week', 'Completed', 'Cancelled', 'Rescheduled'],
                    ['W1', 85, 8, 7], ['W2', 88, 6, 6], ['W3', 82, 10, 8],
                    ['W4', 90, 5, 5], ['W5', 87, 7, 6], ['W6', 92, 4, 4]
                  ],
                  height: 250,
                  colors: ['#22c55e', '#ef4444', '#f59e0b']
                })
              )
            )
          )
        );
      };

      // Patients Page
      const PatientsPage = ({ openAddModal: initialOpenModal }) => {
        const [searchQuery, setSearchQuery] = React.useState('');
        const [showAddModal, setShowAddModal] = React.useState(false);
        const [refreshKey, setRefreshKey] = React.useState(0);
        const { data, loading, error } = useFetch(`${CLINICAL_API}/fhir/Patient`, [refreshKey]);

        // Open modal when navigated with openAddModal option
        React.useEffect(() => {
          if (initialOpenModal) setShowAddModal(true);
        }, [initialOpenModal]);

        const filteredData = React.useMemo(() => {
          if (!data || !searchQuery) return data || [];
          const q = searchQuery.toLowerCase();
          return data.filter(p =>
            (p.GivenName && p.GivenName.toLowerCase().includes(q)) ||
            (p.FamilyName && p.FamilyName.toLowerCase().includes(q)) ||
            (p.Id && p.Id.toString().toLowerCase().includes(q))
          );
        }, [data, searchQuery]);

        const columns = [
          { key: 'Id', header: 'ID', render: p => p.Id || '-' },
          { key: 'name', header: 'Name', render: p => `${p.GivenName || ''} ${p.FamilyName || ''}`.trim() || '-' },
          { key: 'BirthDate', header: 'Birth Date', render: p => p.BirthDate || '-' },
          { key: 'Gender', header: 'Gender', render: p => p.Gender ? p.Gender.charAt(0).toUpperCase() + p.Gender.slice(1) : '-' },
          { key: 'status', header: 'Status', render: () => React.createElement('span', { className: 'badge badge-success' }, 'Active') }
        ];

        return React.createElement('div', { className: 'page' },
          React.createElement(AddPatientModal, {
            isOpen: showAddModal,
            onClose: () => setShowAddModal(false),
            onSuccess: () => setRefreshKey(k => k + 1)
          }),
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Patients'),
            React.createElement('p', { className: 'page-description' }, 'Manage patient records')
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('div', { className: 'header-search' },
                React.createElement(Icons.Search),
                React.createElement('input', {
                  type: 'text',
                  className: 'input',
                  placeholder: 'Search patients...',
                  value: searchQuery,
                  onChange: e => setSearchQuery(e.target.value)
                })
              ),
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: () => setShowAddModal(true),
                'data-testid': 'add-patient-btn'
              }, '+ Add Patient')
            ),
            React.createElement('div', { className: 'card-body' },
              error ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
                React.createElement('h4', { className: 'empty-state-title' }, 'Could not load patients'),
                React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Clinical API is running on port 5080')
              ) : React.createElement(DataTable, { columns, data: filteredData, loading })
            )
          )
        );
      };

      // Practitioners Page
      const PractitionersPage = () => {
        const { data, loading, error } = useFetch(`${SCHEDULING_API}/Practitioner`);

        return React.createElement('div', { className: 'page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Practitioners'),
            React.createElement('p', { className: 'page-description' }, 'Manage healthcare providers')
          ),
          error ? React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'empty-state' },
              React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
              React.createElement('h4', { className: 'empty-state-title' }, 'Could not load practitioners'),
              React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Scheduling API is running on port 5001')
            )
          ) : loading ? React.createElement('div', { className: 'dashboard-grid practitioners' },
            [...Array(6)].map((_, i) => React.createElement('div', { key: i, className: 'card' },
              React.createElement('div', { className: 'skeleton', style: { height: '200px' } })
            ))
          ) : React.createElement('div', { className: 'dashboard-grid practitioners' },
            (data || []).map(p =>
              React.createElement('div', { key: p.Id || p.Identifier, className: 'card practitioner-card' },
                React.createElement('div', { className: 'practitioner-avatar' },
                  React.createElement('div', { className: 'avatar avatar-lg' },
                    (p.NameGiven?.[0] || '') + (p.NameFamily?.[0] || '')
                  )
                ),
                React.createElement('h4', { className: 'practitioner-name' },
                  `${p.NameGiven || ''} ${p.NameFamily || ''}`.trim() || 'Unknown'
                ),
                React.createElement('p', { className: 'practitioner-specialty' }, p.Specialty || 'General'),
                React.createElement('div', { className: 'practitioner-meta' },
                  React.createElement('span', { className: 'badge badge-info' }, p.Qualification || 'MD')
                )
              )
            )
          )
        );
      };

      // Appointments Page
      const AppointmentsPage = ({ openAddModal: initialOpenModal }) => {
        const [filter, setFilter] = React.useState('all');
        const [showAddModal, setShowAddModal] = React.useState(false);
        const [refreshKey, setRefreshKey] = React.useState(0);
        const { data, loading, error } = useFetch(`${SCHEDULING_API}/Appointment`, [refreshKey]);

        // Open modal when navigated with openAddModal option
        React.useEffect(() => {
          if (initialOpenModal) setShowAddModal(true);
        }, [initialOpenModal]);

        const filteredData = React.useMemo(() => {
          if (!data) return [];
          if (filter === 'all') return data;
          return data.filter(a => a.Status?.toLowerCase() === filter);
        }, [data, filter]);

        const columns = [
          { key: 'Id', header: 'ID', render: a => a.Id || '-' },
          { key: 'ServiceType', header: 'Type', render: a => a.ServiceType || a.ServiceCategory || '-' },
          { key: 'patient', header: 'Patient', render: a => a.PatientReference || '-' },
          { key: 'practitioner', header: 'Practitioner', render: a => a.PractitionerReference || '-' },
          { key: 'date', header: 'Date/Time', render: a => a.Start || a.StartTime || '-' },
          { key: 'status', header: 'Status', render: a => React.createElement('span', {
            className: `badge ${a.Status === 'booked' ? 'badge-primary' : a.Status === 'fulfilled' ? 'badge-success' : a.Status === 'cancelled' ? 'badge-danger' : 'badge-secondary'}`
          }, a.Status || 'pending') }
        ];

        return React.createElement('div', { className: 'page' },
          React.createElement(AddAppointmentModal, {
            isOpen: showAddModal,
            onClose: () => setShowAddModal(false),
            onSuccess: () => setRefreshKey(k => k + 1)
          }),
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, 'Appointments'),
            React.createElement('p', { className: 'page-description' }, 'Manage scheduling and appointments')
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'card-header' },
              React.createElement('div', { className: 'btn-group' },
                ['all', 'booked', 'fulfilled', 'cancelled'].map(f =>
                  React.createElement('button', {
                    key: f,
                    className: `btn btn-sm ${filter === f ? 'btn-primary' : 'btn-ghost'}`,
                    onClick: () => setFilter(f)
                  }, f.charAt(0).toUpperCase() + f.slice(1))
                )
              ),
              React.createElement('button', {
                className: 'btn btn-primary',
                onClick: () => setShowAddModal(true),
                'data-testid': 'add-appointment-btn'
              }, '+ New Appointment')
            ),
            React.createElement('div', { className: 'card-body' },
              error ? React.createElement('div', { className: 'empty-state' },
                React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.AlertCircle)),
                React.createElement('h4', { className: 'empty-state-title' }, 'Could not load appointments'),
                React.createElement('p', { className: 'empty-state-description' }, 'Make sure the Scheduling API is running on port 5001')
              ) : React.createElement(DataTable, { columns, data: filteredData, loading })
            )
          )
        );
      };

      // Placeholder Page
      const PlaceholderPage = ({ title, description }) => (
        React.createElement('div', { className: 'page' },
          React.createElement('div', { className: 'page-header' },
            React.createElement('h2', { className: 'page-title' }, title),
            React.createElement('p', { className: 'page-description' }, description)
          ),
          React.createElement('div', { className: 'card' },
            React.createElement('div', { className: 'empty-state' },
              React.createElement('div', { className: 'empty-state-icon' }, React.createElement(Icons.Clipboard)),
              React.createElement('h4', { className: 'empty-state-title' }, 'Coming Soon'),
              React.createElement('p', { className: 'empty-state-description' }, 'This page is under development.')
            )
          )
        )
      );

      // Sidebar Component
      const Sidebar = ({ activeView, onNavigate, collapsed, onToggle }) => {
        const navSections = [
          { title: 'Overview', items: [{ id: 'dashboard', label: 'Dashboard', icon: Icons.Home }] },
          { title: 'Clinical', items: [
            { id: 'patients', label: 'Patients', icon: Icons.Users },
            { id: 'encounters', label: 'Encounters', icon: Icons.Clipboard },
            { id: 'conditions', label: 'Conditions', icon: Icons.Activity }
          ]},
          { title: 'Scheduling', items: [
            { id: 'practitioners', label: 'Practitioners', icon: Icons.UserDoctor },
            { id: 'appointments', label: 'Appointments', icon: Icons.Calendar }
          ]}
        ];

        return React.createElement('aside', { className: `sidebar ${collapsed ? 'collapsed' : ''}` },
          React.createElement('div', { className: 'sidebar-header' },
            React.createElement('a', { className: 'sidebar-logo', href: '#' },
              React.createElement('div', { className: 'sidebar-logo-icon' },
                React.createElement(Icons.Activity)
              ),
              React.createElement('span', { className: 'sidebar-logo-text' }, 'Healthcare')
            )
          ),
          React.createElement('nav', { className: 'sidebar-nav' },
            navSections.map(section =>
              React.createElement('div', { key: section.title, className: 'nav-section' },
                React.createElement('div', { className: 'nav-section-title' }, section.title),
                section.items.map(item =>
                  React.createElement('a', {
                    key: item.id,
                    className: `nav-item ${activeView === item.id ? 'active' : ''}`,
                    onClick: () => onNavigate(item.id)
                  },
                    React.createElement('span', { className: 'nav-item-icon' }, React.createElement(item.icon)),
                    React.createElement('span', { className: 'nav-item-text' }, item.label)
                  )
                )
              )
            )
          ),
          React.createElement('button', { className: 'sidebar-toggle', onClick: onToggle },
            collapsed ? React.createElement(Icons.ChevronRight) : React.createElement(Icons.ChevronLeft)
          ),
          React.createElement('div', { className: 'sidebar-footer' },
            React.createElement('div', { className: 'sidebar-user' },
              React.createElement('div', { className: 'avatar avatar-sm' }, 'JD'),
              React.createElement('div', { className: 'sidebar-user-info' },
                React.createElement('div', { className: 'sidebar-user-name' }, 'John Doe'),
                React.createElement('div', { className: 'sidebar-user-role' }, 'Administrator')
              )
            )
          )
        );
      };

      // Header Component
      const Header = ({ title, searchQuery, onSearchChange }) => (
        React.createElement('header', { className: 'header' },
          React.createElement('div', { className: 'header-left' },
            React.createElement('h1', { className: 'header-title' }, title)
          ),
          React.createElement('div', { className: 'header-right' },
            React.createElement('div', { className: 'header-search' },
              React.createElement(Icons.Search),
              React.createElement('input', {
                type: 'text',
                className: 'input',
                placeholder: 'Search...',
                value: searchQuery,
                onChange: e => onSearchChange(e.target.value)
              })
            ),
            React.createElement('div', { className: 'header-actions' },
              React.createElement('button', { className: 'header-action-btn' },
                React.createElement(Icons.Bell),
                React.createElement('span', { className: 'header-action-badge' })
              ),
              React.createElement('div', { className: 'avatar avatar-md' }, 'JD')
            )
          )
        )
      );

      // Main App Component
      const App = () => {
        const [activeView, setActiveView] = React.useState('dashboard');
        const [sidebarCollapsed, setSidebarCollapsed] = React.useState(false);
        const [searchQuery, setSearchQuery] = React.useState('');
        const [navigationOptions, setNavigationOptions] = React.useState({});

        // Navigation handler that supports options
        const handleNavigate = (view, options = {}) => {
          setActiveView(view);
          setNavigationOptions(options);
        };

        // Clear navigation options after page renders
        React.useEffect(() => {
          if (Object.keys(navigationOptions).length > 0) {
            const timer = setTimeout(() => setNavigationOptions({}), 100);
            return () => clearTimeout(timer);
          }
        }, [navigationOptions]);

        const getPageTitle = () => ({
          dashboard: 'Dashboard',
          patients: 'Patients',
          encounters: 'Encounters',
          conditions: 'Conditions',
          practitioners: 'Practitioners',
          appointments: 'Appointments',
          settings: 'Settings'
        }[activeView] || 'Healthcare');

        const renderPage = () => {
          switch (activeView) {
            case 'dashboard': return React.createElement(DashboardPage, { onNavigate: handleNavigate });
            case 'patients': return React.createElement(PatientsPage, { openAddModal: navigationOptions.openAddModal });
            case 'practitioners': return React.createElement(PractitionersPage);
            case 'appointments': return React.createElement(AppointmentsPage, { openAddModal: navigationOptions.openAddModal });
            case 'encounters': return React.createElement(PlaceholderPage, { title: 'Encounters', description: 'Manage patient encounters and visits' });
            case 'conditions': return React.createElement(PlaceholderPage, { title: 'Conditions', description: 'View and manage patient conditions' });
            default: return React.createElement(PlaceholderPage, { title: 'Page Not Found', description: 'The requested page does not exist' });
          }
        };

        return React.createElement('div', { className: 'app' },
          React.createElement(Sidebar, {
            activeView,
            onNavigate: setActiveView,
            collapsed: sidebarCollapsed,
            onToggle: () => setSidebarCollapsed(!sidebarCollapsed)
          }),
          React.createElement('div', { className: 'main-wrapper' },
            React.createElement(Header, {
              title: getPageTitle(),
              searchQuery,
              onSearchChange: setSearchQuery
            }),
            React.createElement('main', { className: 'main-content' }, renderPage())
          )
        );
      };

      // Export App for testing
      window.App = App;

    // Render the app
    console.log('[Dashboard] Mounting React application...');
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
    console.log('[Dashboard] Application ready!');
  </script>
</body>
</html>
