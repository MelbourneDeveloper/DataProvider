Customer
|> join(Address, on = Customer.Id = Address.CustomerId)
|> filter(fn(row) => (@customerId IS NULL OR Customer.Id = @customerId))
|> select(Customer.Id, Customer.CustomerName, Customer.Email, Customer.Phone, Customer.CreatedDate, Address.Id AS AddressId, Address.CustomerId, Address.Street, Address.City, Address.State, Address.ZipCode, Address.Country)
|> order_by(Customer.CustomerName)